digraph overview {
    node [ shape=record, style="filled" ];
    splines = curved;

    targetobs [ label="Target\nObs", shape=circle ];
    calobs [ label="Calibration\nObs", shape=circle ];
    calvcs [ label="Is data VCS or\ncalibrated visibilities?", shape=diamond, fillcolor=yellow ];
    date [ label="Before\nSep 2021?", shape=diamond, fillcolor=yellow ];
    raw [ label="Fine channel\nvoltages (.raw)", fillcolor=green ];
    sub [ label="Coarse channel\nvoltages (.sub)", fillcolor=green ];
    dat [ label="Recombined\nvoltages (.dat)", fillcolor=green ];
    vis [ label="Correlated\nvisibilities (.fits)", fillcolor=green ];
    outputchannelisation [ label="Output\nchannelisation?", shape=diamond, fillcolor=yellow ];
    psrfits [ label="PSRFITS\nFull Stokes", fillcolor=green ];
    vdif [ label="VDIF\nVoltages", fillcolor=green ];
    calsol [ label="Calibration solution\n(.bin or RTS)", fillcolor=green ];
    recombine [ label="recombine", shape=invhouse ];
    tiedarray [ label="make_mwa_tied_array_beam", shape=invhouse ];
    rts [ label="RTS/Hyperdrive", shape=invhouse ];

    targetobs -> date;
    date -> raw [ xlabel="Yes (Legacy)" ];
    date -> sub [ label="No (MWAX)" ];
    sub:se -> tiedarray:ne;

    offlinepfb [ label="fine_pfb_offline", shape=invhouse ];
    offlinecorr [ label="Offline Correlator*", shape=invhouse ];

    raw -> recombine -> dat;
    sub -> offlinepfb -> dat;
    dat -> tiedarray -> outputchannelisation;
    outputchannelisation -> psrfits [ xlabel="10 kHz" ];
    outputchannelisation -> vdif [ label="1.28 MHz" ];
    calsol -> tiedarray;
    calobs -> calvcs;
    calvcs -> offlinecorr [ label="Yes" ];
    offlinecorr -> vis;
    calvcs -> rts [ label="No" ];
    rts -> calsol;
    vis -> rts -> calsol;

    {rank = same; targetobs; calobs; }
    {rank = same; date; calvcs; }
    {rank = same; raw; sub;}
}
