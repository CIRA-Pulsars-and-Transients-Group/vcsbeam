<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VCSBeam: form_beam.cu File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_tiny.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VCSBeam
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">form_beam.cu File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;cuComplex.h&gt;</code><br />
<code>#include &lt;cuda_runtime.h&gt;</code><br />
<code>#include &quot;vcsbeam.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for form_beam.cu:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="form__beam_8cu__incl.svg" width="100%" height="384"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3f6ea8e9ef58125936d50d7e1181aa7a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a3f6ea8e9ef58125936d50d7e1181aa7a">gpuErrchk</a>(ans)&#160;&#160;&#160;{<a class="el" href="pfb_8cu.html#ab3e90881a2476fd461eb2bcfcaa7cf63">gpuAssert</a>((ans), __FILE__, __LINE__, true);}</td></tr>
<tr class="separator:a3f6ea8e9ef58125936d50d7e1181aa7a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab3e90881a2476fd461eb2bcfcaa7cf63"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#ab3e90881a2476fd461eb2bcfcaa7cf63">gpuAssert</a> (cudaError_t code, const char *file, int line, bool abort=true)</td></tr>
<tr class="separator:ab3e90881a2476fd461eb2bcfcaa7cf63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa400133bd01d7bfad48022e525106583"><td class="memItemLeft" align="right" valign="top">__global__ void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#aa400133bd01d7bfad48022e525106583">incoh_beam</a> (uint8_t *data, float *incoh)</td></tr>
<tr class="memdesc:aa400133bd01d7bfad48022e525106583"><td class="mdescLeft">&#160;</td><td class="mdescRight">CUDA kernel for computing an incoherent beam.  <a href="form__beam_8cu.html#aa400133bd01d7bfad48022e525106583">More...</a><br /></td></tr>
<tr class="separator:aa400133bd01d7bfad48022e525106583"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72ec9b11b7031b21033c939c39c3f0f1"><td class="memItemLeft" align="right" valign="top">__global__ void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a72ec9b11b7031b21033c939c39c3f0f1">vmApplyJ_kernel</a> (void *data, cuDoubleComplex *J, cuDoubleComplex *Jv_Q, cuDoubleComplex *Jv_P, uint32_t *polQ_idxs, uint32_t *polP_idxs, int npol, int p, vcsbeam_datatype datatype)</td></tr>
<tr class="memdesc:a72ec9b11b7031b21033c939c39c3f0f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">CUDA kernel for multiplying Jones matrices to Jones vectors.  <a href="form__beam_8cu.html#a72ec9b11b7031b21033c939c39c3f0f1">More...</a><br /></td></tr>
<tr class="separator:a72ec9b11b7031b21033c939c39c3f0f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e7f514db5ee2dafe8a622e01054007e"><td class="memItemLeft" align="right" valign="top">__global__ void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a8e7f514db5ee2dafe8a622e01054007e">vmBeamform_kernel</a> (cuDoubleComplex *Jv_Q, cuDoubleComplex *Jv_P, cuDoubleComplex *phi, double invw, int p, int soffset, int nchunk, cuDoubleComplex *e, float *S, int npol, int nstokes)</td></tr>
<tr class="memdesc:a8e7f514db5ee2dafe8a622e01054007e"><td class="mdescLeft">&#160;</td><td class="mdescRight">CUDA kernel for phasing up and summing the voltages over antenna.  <a href="form__beam_8cu.html#a8e7f514db5ee2dafe8a622e01054007e">More...</a><br /></td></tr>
<tr class="separator:a8e7f514db5ee2dafe8a622e01054007e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a418658321f739c188e3adee521b3c03b"><td class="memItemLeft" align="right" valign="top">__global__ void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a418658321f739c188e3adee521b3c03b">renormalise_channels_kernel</a> (float *S, int nstep, float *offsets, float *scales, uint8_t *Sscaled)</td></tr>
<tr class="memdesc:a418658321f739c188e3adee521b3c03b"><td class="mdescLeft">&#160;</td><td class="mdescRight">CUDA kernel for normalising Stokes parameters.  <a href="form__beam_8cu.html#a418658321f739c188e3adee521b3c03b">More...</a><br /></td></tr>
<tr class="separator:a418658321f739c188e3adee521b3c03b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefd0c7b588cf2413c51863dcb4d25521"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#aefd0c7b588cf2413c51863dcb4d25521">cu_form_incoh_beam</a> (uint8_t *data, uint8_t *d_data, size_t data_size, float *d_incoh, unsigned int nsample, int nchan, int ninput, float *offsets, float *d_offsets, float *scales, float *d_scales, uint8_t *Iscaled, uint8_t *d_Iscaled, size_t Iscaled_size)</td></tr>
<tr class="memdesc:aefd0c7b588cf2413c51863dcb4d25521"><td class="mdescLeft">&#160;</td><td class="mdescRight">Form an incoherent beam.  <a href="form__beam_8cu.html#aefd0c7b588cf2413c51863dcb4d25521">More...</a><br /></td></tr>
<tr class="separator:aefd0c7b588cf2413c51863dcb4d25521"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a215f77c938330e13916a9eedd6b675aa"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a215f77c938330e13916a9eedd6b675aa">vmApplyJChunk</a> (vcsbeam_context *vm)</td></tr>
<tr class="memdesc:a215f77c938330e13916a9eedd6b675aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes \({\bf J}^{-1} {\bf v}\).  <a href="form__beam_8cu.html#a215f77c938330e13916a9eedd6b675aa">More...</a><br /></td></tr>
<tr class="separator:a215f77c938330e13916a9eedd6b675aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cf45d9edacf3bf40f3eabcfd58094cd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a0cf45d9edacf3bf40f3eabcfd58094cd">vmBeamformChunk</a> (vcsbeam_context *vm)</td></tr>
<tr class="memdesc:a0cf45d9edacf3bf40f3eabcfd58094cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs the phasing up, averaging over antennas, and detection operations on calibrated data.  <a href="form__beam_8cu.html#a0cf45d9edacf3bf40f3eabcfd58094cd">More...</a><br /></td></tr>
<tr class="separator:a0cf45d9edacf3bf40f3eabcfd58094cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56e5357bff69a7f58f89578ef3130c41"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a56e5357bff69a7f58f89578ef3130c41">vmBeamformSecond</a> (vcsbeam_context *vm)</td></tr>
<tr class="memdesc:a56e5357bff69a7f58f89578ef3130c41"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs all beamforming steps for 1 second's worth of data.  <a href="form__beam_8cu.html#a56e5357bff69a7f58f89578ef3130c41">More...</a><br /></td></tr>
<tr class="separator:a56e5357bff69a7f58f89578ef3130c41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb4b6bf2611fd604b7fa43d6e588ca5d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#abb4b6bf2611fd604b7fa43d6e588ca5d">vmPullE</a> (vcsbeam_context *vm)</td></tr>
<tr class="memdesc:abb4b6bf2611fd604b7fa43d6e588ca5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies the beamformed voltages from GPU memory to CPU memory.  <a href="form__beam_8cu.html#abb4b6bf2611fd604b7fa43d6e588ca5d">More...</a><br /></td></tr>
<tr class="separator:abb4b6bf2611fd604b7fa43d6e588ca5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28a2fb5a5b33087e894b34e8fbe83a35"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a28a2fb5a5b33087e894b34e8fbe83a35">vmPullS</a> (vcsbeam_context *vm)</td></tr>
<tr class="memdesc:a28a2fb5a5b33087e894b34e8fbe83a35"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies the detected Stokes parameters from GPU memory to CPU memory.  <a href="form__beam_8cu.html#a28a2fb5a5b33087e894b34e8fbe83a35">More...</a><br /></td></tr>
<tr class="separator:a28a2fb5a5b33087e894b34e8fbe83a35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e2778cd4e010763af76bd3d820133f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a4e2778cd4e010763af76bd3d820133f1">prepare_detected_beam</a> (cuDoubleComplex ****detected_beam, mpi_psrfits *mpfs, vcsbeam_context *vm)</td></tr>
<tr class="memdesc:a4e2778cd4e010763af76bd3d820133f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies the beamformed voltages into a different array to prepare for inverting the PFB.  <a href="form__beam_8cu.html#a4e2778cd4e010763af76bd3d820133f1">More...</a><br /></td></tr>
<tr class="separator:a4e2778cd4e010763af76bd3d820133f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35a259c82a7809d57d0c9d16dcf3be92"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a35a259c82a7809d57d0c9d16dcf3be92">vmSendSToFits</a> (vcsbeam_context *vm, mpi_psrfits *mpfs)</td></tr>
<tr class="memdesc:a35a259c82a7809d57d0c9d16dcf3be92"><td class="mdescLeft">&#160;</td><td class="mdescRight">Renormalises the detected Stokes parameters and copies them into PSRFITS structs, ready for frequency splicing.  <a href="form__beam_8cu.html#a35a259c82a7809d57d0c9d16dcf3be92">More...</a><br /></td></tr>
<tr class="separator:a35a259c82a7809d57d0c9d16dcf3be92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a195dcc4bde9607ce0eadf60f85be8bcf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a195dcc4bde9607ce0eadf60f85be8bcf">vmPushPolIdxLists</a> (vcsbeam_context *vm)</td></tr>
<tr class="memdesc:a195dcc4bde9607ce0eadf60f85be8bcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies the index arrays for antennas and polarisations from CPU memory to GPU memory.  <a href="form__beam_8cu.html#a195dcc4bde9607ce0eadf60f85be8bcf">More...</a><br /></td></tr>
<tr class="separator:a195dcc4bde9607ce0eadf60f85be8bcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a433ddbce6c91b6c67daddb48bbcd5aea"><td class="memItemLeft" align="right" valign="top">float *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a433ddbce6c91b6c67daddb48bbcd5aea">create_pinned_data_buffer</a> (size_t size)</td></tr>
<tr class="memdesc:a433ddbce6c91b6c67daddb48bbcd5aea"><td class="mdescLeft">&#160;</td><td class="mdescRight">(Deprecated) Allocate memory on the GPU.  <a href="form__beam_8cu.html#a433ddbce6c91b6c67daddb48bbcd5aea">More...</a><br /></td></tr>
<tr class="separator:a433ddbce6c91b6c67daddb48bbcd5aea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2e6ebf2fafcce02526b94cb8f01366f"><td class="memItemLeft" align="right" valign="top">cuDoubleComplex ****&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#ad2e6ebf2fafcce02526b94cb8f01366f">create_detected_beam</a> (int npointing, int nsamples, int nchan, int npol)</td></tr>
<tr class="memdesc:ad2e6ebf2fafcce02526b94cb8f01366f"><td class="mdescLeft">&#160;</td><td class="mdescRight">(Deprecated) Allocate memory on the CPU.  <a href="form__beam_8cu.html#ad2e6ebf2fafcce02526b94cb8f01366f">More...</a><br /></td></tr>
<tr class="separator:ad2e6ebf2fafcce02526b94cb8f01366f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae97c305b54fb67d57a8fd9c0af5be03a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#ae97c305b54fb67d57a8fd9c0af5be03a">destroy_detected_beam</a> (cuDoubleComplex ****array, int npointing, int nsamples, int nchan)</td></tr>
<tr class="memdesc:ae97c305b54fb67d57a8fd9c0af5be03a"><td class="mdescLeft">&#160;</td><td class="mdescRight">(Deprecated) Frees memory on the CPU.  <a href="form__beam_8cu.html#ae97c305b54fb67d57a8fd9c0af5be03a">More...</a><br /></td></tr>
<tr class="separator:ae97c305b54fb67d57a8fd9c0af5be03a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42a8b688f3ed69468b056044bb26461e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a42a8b688f3ed69468b056044bb26461e">allocate_input_output_arrays</a> (void **data, void **d_data, size_t size)</td></tr>
<tr class="memdesc:a42a8b688f3ed69468b056044bb26461e"><td class="mdescLeft">&#160;</td><td class="mdescRight">(Deprecated) Allocates memory on the CPU and GPU simultaneously.  <a href="form__beam_8cu.html#a42a8b688f3ed69468b056044bb26461e">More...</a><br /></td></tr>
<tr class="separator:a42a8b688f3ed69468b056044bb26461e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91c2e34710672b16c62eaf94e46b7ba0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="form__beam_8cu.html#a91c2e34710672b16c62eaf94e46b7ba0">free_input_output_arrays</a> (void *data, void *d_data)</td></tr>
<tr class="memdesc:a91c2e34710672b16c62eaf94e46b7ba0"><td class="mdescLeft">&#160;</td><td class="mdescRight">(Deprecated) Frees memory on the CPU and GPU simultaneously.  <a href="form__beam_8cu.html#a91c2e34710672b16c62eaf94e46b7ba0">More...</a><br /></td></tr>
<tr class="separator:a91c2e34710672b16c62eaf94e46b7ba0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a3f6ea8e9ef58125936d50d7e1181aa7a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f6ea8e9ef58125936d50d7e1181aa7a">&#9670;&nbsp;</a></span>gpuErrchk</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define gpuErrchk</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">ans</td><td>)</td>
          <td>&#160;&#160;&#160;{<a class="el" href="pfb_8cu.html#ab3e90881a2476fd461eb2bcfcaa7cf63">gpuAssert</a>((ans), __FILE__, __LINE__, true);}</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a42a8b688f3ed69468b056044bb26461e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42a8b688f3ed69468b056044bb26461e">&#9670;&nbsp;</a></span>allocate_input_output_arrays()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void allocate_input_output_arrays </td>
          <td>(</td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>d_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(Deprecated) Allocates memory on the CPU and GPU simultaneously. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000016">Todo:</a></b></dt><dd>Remove the function <a class="el" href="form__beam_8cu.html#a42a8b688f3ed69468b056044bb26461e" title="(Deprecated) Allocates memory on the CPU and GPU simultaneously.">allocate_input_output_arrays()</a>. </dd></dl>

</div>
</div>
<a id="ad2e6ebf2fafcce02526b94cb8f01366f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2e6ebf2fafcce02526b94cb8f01366f">&#9670;&nbsp;</a></span>create_detected_beam()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cuDoubleComplex**** create_detected_beam </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>npointing</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsamples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nchan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>npol</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(Deprecated) Allocate memory on the CPU. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000014">Todo:</a></b></dt><dd>Remove the function <a class="el" href="form__beam_8cu.html#ad2e6ebf2fafcce02526b94cb8f01366f" title="(Deprecated) Allocate memory on the CPU.">create_detected_beam()</a>. </dd></dl>

</div>
</div>
<a id="a433ddbce6c91b6c67daddb48bbcd5aea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a433ddbce6c91b6c67daddb48bbcd5aea">&#9670;&nbsp;</a></span>create_pinned_data_buffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float* create_pinned_data_buffer </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(Deprecated) Allocate memory on the GPU. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000013">Todo:</a></b></dt><dd>Remove the function <a class="el" href="form__beam_8cu.html#a433ddbce6c91b6c67daddb48bbcd5aea" title="(Deprecated) Allocate memory on the GPU.">create_pinned_data_buffer()</a>. </dd></dl>

</div>
</div>
<a id="aefd0c7b588cf2413c51863dcb4d25521"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aefd0c7b588cf2413c51863dcb4d25521">&#9670;&nbsp;</a></span>cu_form_incoh_beam()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cu_form_incoh_beam </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>d_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>data_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>d_incoh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nsample</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nchan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ninput</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>offsets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>d_offsets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>scales</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>d_scales</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>Iscaled</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>d_Iscaled</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>Iscaled_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Form an incoherent beam. </p>
<p>Forms an incoherent beam, detects it, and prepares it for writing to PSRFITS.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000010">Todo:</a></b></dt><dd>Either generalise the <a class="el" href="form__beam_8cu.html#a0cf45d9edacf3bf40f3eabcfd58094cd" title="Performs the phasing up, averaging over antennas, and detection operations on calibrated data.">vmBeamformChunk()</a> so that it can also produce incoherent beams (and therefore do away with <a class="el" href="form__beam_8cu.html#aefd0c7b588cf2413c51863dcb4d25521" title="Form an incoherent beam.">cu_form_incoh_beam()</a>, or keep <a class="el" href="form__beam_8cu.html#aefd0c7b588cf2413c51863dcb4d25521" title="Form an incoherent beam.">cu_form_incoh_beam()</a> and convert it into a bona fide "vm" style fuction. </dd></dl>

</div>
</div>
<a id="ae97c305b54fb67d57a8fd9c0af5be03a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae97c305b54fb67d57a8fd9c0af5be03a">&#9670;&nbsp;</a></span>destroy_detected_beam()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void destroy_detected_beam </td>
          <td>(</td>
          <td class="paramtype">cuDoubleComplex ****&#160;</td>
          <td class="paramname"><em>array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>npointing</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nsamples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nchan</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(Deprecated) Frees memory on the CPU. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000015">Todo:</a></b></dt><dd>Remove the function <a class="el" href="form__beam_8cu.html#ae97c305b54fb67d57a8fd9c0af5be03a" title="(Deprecated) Frees memory on the CPU.">destroy_detected_beam()</a>. </dd></dl>

</div>
</div>
<a id="a91c2e34710672b16c62eaf94e46b7ba0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91c2e34710672b16c62eaf94e46b7ba0">&#9670;&nbsp;</a></span>free_input_output_arrays()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_input_output_arrays </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>d_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(Deprecated) Frees memory on the CPU and GPU simultaneously. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000017">Todo:</a></b></dt><dd>Remove the function <a class="el" href="form__beam_8cu.html#a91c2e34710672b16c62eaf94e46b7ba0" title="(Deprecated) Frees memory on the CPU and GPU simultaneously.">free_input_output_arrays()</a>. </dd></dl>

</div>
</div>
<a id="ab3e90881a2476fd461eb2bcfcaa7cf63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3e90881a2476fd461eb2bcfcaa7cf63">&#9670;&nbsp;</a></span>gpuAssert()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void gpuAssert </td>
          <td>(</td>
          <td class="paramtype">cudaError_t&#160;</td>
          <td class="paramname"><em>code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>abort</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aa400133bd01d7bfad48022e525106583"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa400133bd01d7bfad48022e525106583">&#9670;&nbsp;</a></span>incoh_beam()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void incoh_beam </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>incoh</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CUDA kernel for computing an incoherent beam. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>The voltage data, \(v\), with layout \(N_t \times N_f \times N_i\). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">incoh</td><td>The detected (Stokes I) powers, \(I\), with layout \(N_t \times N_f\).</td></tr>
  </table>
  </dd>
</dl>
<p>The incoherent beam is the expression </p><p class="formulaDsp">
\[ I_{t,f} = \sum_i v_{t,f,i}^\dagger v_{t,f,i}. \]
</p>
<p>The expected thread configuration is \(\langle\langle\langle(N_f, N_t), N_i\rangle\rangle\rangle.\)</p>
<p>Note that if the voltages were arranged into Jones vectors, the above could also be expressed in the more familiar form </p><p class="formulaDsp">
\[ I_{t,f} = \sum_a {\bf v}_{t,f,a}^\dagger {\bf v}_{t,f,a}. \]
</p>
 
</div>
</div>
<a id="a4e2778cd4e010763af76bd3d820133f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e2778cd4e010763af76bd3d820133f1">&#9670;&nbsp;</a></span>prepare_detected_beam()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void prepare_detected_beam </td>
          <td>(</td>
          <td class="paramtype">cuDoubleComplex ****&#160;</td>
          <td class="paramname"><em>detected_beam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mpi_psrfits *&#160;</td>
          <td class="paramname"><em>mpfs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies the beamformed voltages into a different array to prepare for inverting the PFB. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000012">Todo:</a></b></dt><dd>Remove <a class="el" href="form__beam_8cu.html#a4e2778cd4e010763af76bd3d820133f1" title="Copies the beamformed voltages into a different array to prepare for inverting the PFB.">prepare_detected_beam()</a> and use a "host buffer" instead. </dd></dl>

</div>
</div>
<a id="a418658321f739c188e3adee521b3c03b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a418658321f739c188e3adee521b3c03b">&#9670;&nbsp;</a></span>renormalise_channels_kernel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void renormalise_channels_kernel </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nstep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>offsets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>scales</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>Sscaled</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CUDA kernel for normalising Stokes parameters. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">S</td><td>The original Stokes parameters, with layout \(N_t \times N_s \times N_f\) </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">nstep</td><td>\(N_t\) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">offsets</td><td>The amount of offset needed to recover the original values from the normalised ones </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">scales</td><td>The scaling needed to recover the original values from the normalised ones </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Sscaled</td><td>The normalised Stokes parameters</td></tr>
  </table>
  </dd>
</dl>
<p>This kernel shifts and normalises the Stokes parameters so that they fit into 8-bits integers without clipping (e.g. for output into the PSRFITS format). Each frequency is normalised independently, with the scales and offsets needed to recover the original values for that channel being recorded as well.</p>
<p>If \({\bf S}\) is the array of values to be normalised, then the normalisation is </p><p class="formulaDsp">
\[ \hat{\bf S} = \frac{{\bf S} - \text{offset}}{\text{scale}}, \]
</p>
<p> where </p><p class="formulaDsp">
\begin{align*} \text{scale} &amp;= \frac{S_\text{max} - S_\text{min}}{256} \\ \text{offset} &amp;= S_\text{min} + 0.5 \times \text{scale}. \end{align*}
</p>
<p>The expected thread configuration is \(\langle\langle\langle N_b,(N_f, N_s)\rangle\rangle\rangle.\)</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd>Optimise the renormalisation kernel (e.g. by removing the for loop over timesteps. </dd></dl>

</div>
</div>
<a id="a72ec9b11b7031b21033c939c39c3f0f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72ec9b11b7031b21033c939c39c3f0f1">&#9670;&nbsp;</a></span>vmApplyJ_kernel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void vmApplyJ_kernel </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cuDoubleComplex *&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cuDoubleComplex *&#160;</td>
          <td class="paramname"><em>Jv_Q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cuDoubleComplex *&#160;</td>
          <td class="paramname"><em>Jv_P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>polQ_idxs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>polP_idxs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>npol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vcsbeam_datatype&#160;</td>
          <td class="paramname"><em>datatype</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CUDA kernel for multiplying Jones matrices to Jones vectors. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>The voltage data, \(v\), with layout \(N_t \times N_f \times N_i\) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">J</td><td>The Jones matrices, \({\bf J}^{-1}\), with layout \(N_a \times N_f \times N_p \times N_p\) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Jv_Q</td><td>The Q polarisation of the product \({\bf J}^{-1}{\bf v}\), with layout \(N_t \times N_f \times N_a\) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Jv_P</td><td>The P polarisation of the product \({\bf J}^{-1}{\bf v}\), with layout \(N_t \times N_f \times N_a\) </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">polQ_idxs</td><td>And array of the indices \(i\) for the Q polarisations of the antennas </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">polP_idxs</td><td>And array of the indices \(i\) for the P polarisations of the antennas </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">p</td><td>The pointing number </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">soffset</td><td>An offset number of samples into <code>data</code> </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">npol</td><td>\(N_p\) </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">datatype</td><td>Either <code>VM_INT4</code> (if <code>data</code> contain 4+4-bit complex integers) or <code>VM_DBL</code> (if <code>data</code> contain complex doubles).</td></tr>
  </table>
  </dd>
</dl>
<p>Although this kernel is quite general, in the sense that it could be used to multiply any Jones matrices to any Jones vectors, it is used in particular for multiplying the Jones matrices \({\bf J}^{-1}\) to the voltage data \({\bf v}\): </p><p class="formulaDsp">
\[ \tilde{\bf e}_{t,f,a} = {\bf J}^{-1}_{a,f}{\bf v}_{t,f,a}. \]
</p>
<p>The expected thread configuration is \(\langle\langle\langle(N_f, N_t), N_a\rangle\rangle\rangle.\) </p>

</div>
</div>
<a id="a215f77c938330e13916a9eedd6b675aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a215f77c938330e13916a9eedd6b675aa">&#9670;&nbsp;</a></span>vmApplyJChunk()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmApplyJChunk </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes \({\bf J}^{-1} {\bf v}\). </p>

</div>
</div>
<a id="a8e7f514db5ee2dafe8a622e01054007e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e7f514db5ee2dafe8a622e01054007e">&#9670;&nbsp;</a></span>vmBeamform_kernel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__global__ void vmBeamform_kernel </td>
          <td>(</td>
          <td class="paramtype">cuDoubleComplex *&#160;</td>
          <td class="paramname"><em>Jv_Q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cuDoubleComplex *&#160;</td>
          <td class="paramname"><em>Jv_P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cuDoubleComplex *&#160;</td>
          <td class="paramname"><em>phi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>invw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>soffset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nchunk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cuDoubleComplex *&#160;</td>
          <td class="paramname"><em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>S</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>npol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nstokes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CUDA kernel for phasing up and summing the voltages over antenna. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Jv_Q</td><td>The Q polarisation of the product \({\bf J}^{-1}{\bf v}\), with layout \(N_t \times N_f \times N_a\) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Jv_P</td><td>The P polarisation of the product \({\bf J}^{-1}{\bf v}\), with layout \(N_t \times N_f \times N_a\) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phi</td><td>The delay phase, \(\varphi\), with layout \(N_a \times N_f\) </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">invw</td><td>The reciprocal of the number of non-flagged antennas </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">p</td><td>The pointing index </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">soffset</td><td>An offset number of samples into <code>e</code> for where to put the the answer </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">nchunk</td><td>The number of chunks (divisions of a second's worth of data) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">e</td><td>The recovered electric field, \({\bf e}\), with layout \(N_t \times N_f \times N_p\) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">S</td><td>The recovered Stokes parameters, with layout \(N_t \times N_s \times N_f\) </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">npol</td><td>\(N_p\) </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">nstokes</td><td>The number of stokes parameters to output</td></tr>
  </table>
  </dd>
</dl>
<p>This kernel performs the phasing up and the summing over antennas part of the beamforming operation (see <a class="el" href="beamforming.html">Beamforming</a>): </p><p class="formulaDsp">
\[ {\bf e}_{t,f} = \frac{1}{N_a} \sum_a e^{i\varphi} \tilde{\bf e}_{t,f,a}. \]
</p>
<p>It also computes the Stokes parameters, \(S = [I, Q, U, V]\) (with the autocorrelations removed).</p>
<p>The expected thread configuration is \(\langle\langle\langle(N_f, N_t), N_a\rangle\rangle\rangle.\) </p>

</div>
</div>
<a id="a0cf45d9edacf3bf40f3eabcfd58094cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cf45d9edacf3bf40f3eabcfd58094cd">&#9670;&nbsp;</a></span>vmBeamformChunk()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmBeamformChunk </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs the phasing up, averaging over antennas, and detection operations on calibrated data. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000011">Todo:</a></b></dt><dd>Split the beamforming operations into separate steps/kernels. </dd></dl>

</div>
</div>
<a id="a56e5357bff69a7f58f89578ef3130c41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56e5357bff69a7f58f89578ef3130c41">&#9670;&nbsp;</a></span>vmBeamformSecond()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmBeamformSecond </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs all beamforming steps for 1 second's worth of data. </p>

</div>
</div>
<a id="abb4b6bf2611fd604b7fa43d6e588ca5d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb4b6bf2611fd604b7fa43d6e588ca5d">&#9670;&nbsp;</a></span>vmPullE()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmPullE </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies the beamformed voltages from GPU memory to CPU memory. </p>

</div>
</div>
<a id="a28a2fb5a5b33087e894b34e8fbe83a35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28a2fb5a5b33087e894b34e8fbe83a35">&#9670;&nbsp;</a></span>vmPullS()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmPullS </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies the detected Stokes parameters from GPU memory to CPU memory. </p>

</div>
</div>
<a id="a195dcc4bde9607ce0eadf60f85be8bcf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a195dcc4bde9607ce0eadf60f85be8bcf">&#9670;&nbsp;</a></span>vmPushPolIdxLists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmPushPolIdxLists </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies the index arrays for antennas and polarisations from CPU memory to GPU memory. </p>

</div>
</div>
<a id="a35a259c82a7809d57d0c9d16dcf3be92"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35a259c82a7809d57d0c9d16dcf3be92">&#9670;&nbsp;</a></span>vmSendSToFits()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmSendSToFits </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mpi_psrfits *&#160;</td>
          <td class="paramname"><em>mpfs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Renormalises the detected Stokes parameters and copies them into PSRFITS structs, ready for frequency splicing. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vm</td><td>The VCSBeam context struct </td></tr>
    <tr><td class="paramname">mpfs</td><td>The MPI PSRFITS struct that manages the splicing operation. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
