<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VCSBeam: calibration.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VCSBeam
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">calibration.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;mwalib.h&gt;</code><br />
<code>#include &lt;cuComplex.h&gt;</code><br />
<code>#include &quot;vcsbeam.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for calibration.c:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="calibration_8c__incl.svg" width="660" height="112"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe>
</div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a456923a16ff4f680b225d49d7e5ebe63"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#a456923a16ff4f680b225d49d7e5ebe63">vmLoadRTSSolution</a> (vcsbeam_context *vm)</td></tr>
<tr class="memdesc:a456923a16ff4f680b225d49d7e5ebe63"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loads a Real Time System (RTS) calibration solution.  <a href="calibration_8c.html#a456923a16ff4f680b225d49d7e5ebe63">More...</a><br /></td></tr>
<tr class="separator:a456923a16ff4f680b225d49d7e5ebe63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a248707c3daf7f72727671c430e6aa9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#a5a248707c3daf7f72727671c430e6aa9">read_dijones_file</a> (cuDoubleComplex **Dd, cuDoubleComplex *A, double *amp, uintptr_t nant, char *fname)</td></tr>
<tr class="memdesc:a5a248707c3daf7f72727671c430e6aa9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads in an RTS DIJones file.  <a href="calibration_8c.html#a5a248707c3daf7f72727671c430e6aa9">More...</a><br /></td></tr>
<tr class="separator:a5a248707c3daf7f72727671c430e6aa9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad66159c79c4179391e06774105799bfe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#ad66159c79c4179391e06774105799bfe">read_bandpass_file</a> (cuDoubleComplex ***Jm, cuDoubleComplex ***Jf, MetafitsMetadata *cal_metadata, char *filename)</td></tr>
<tr class="memdesc:ad66159c79c4179391e06774105799bfe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads an RTS Bandpass file.  <a href="calibration_8c.html#ad66159c79c4179391e06774105799bfe">More...</a><br /></td></tr>
<tr class="separator:ad66159c79c4179391e06774105799bfe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20eb84ad9699d8bc39c5f0001cf6b246"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#a20eb84ad9699d8bc39c5f0001cf6b246">vmLoadOffringaSolution</a> (vcsbeam_context *vm)</td></tr>
<tr class="memdesc:a20eb84ad9699d8bc39c5f0001cf6b246"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads in a calibration solution from an Offringa-style solution file.  <a href="calibration_8c.html#a20eb84ad9699d8bc39c5f0001cf6b246">More...</a><br /></td></tr>
<tr class="separator:a20eb84ad9699d8bc39c5f0001cf6b246"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6360897603b35d1dfe68032a20b19079"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#a6360897603b35d1dfe68032a20b19079">remove_reference_phase</a> (cuDoubleComplex *J, cuDoubleComplex *Jref)</td></tr>
<tr class="memdesc:a6360897603b35d1dfe68032a20b19079"><td class="mdescLeft">&#160;</td><td class="mdescRight">Rotates the phases of the elements of a complex matrix with respect to a reference matrix.  <a href="calibration_8c.html#a6360897603b35d1dfe68032a20b19079">More...</a><br /></td></tr>
<tr class="separator:a6360897603b35d1dfe68032a20b19079"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8075cee8c51e05b8157a772f3fb10ebc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#a8075cee8c51e05b8157a772f3fb10ebc">zero_PQ_and_QP</a> (cuDoubleComplex *J)</td></tr>
<tr class="memdesc:a8075cee8c51e05b8157a772f3fb10ebc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Zeroes the off-diagonal terms of the given matrix.  <a href="calibration_8c.html#a8075cee8c51e05b8157a772f3fb10ebc">More...</a><br /></td></tr>
<tr class="separator:a8075cee8c51e05b8157a772f3fb10ebc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f042bf36cfe2928b7fcbde7b1ac771f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#a8f042bf36cfe2928b7fcbde7b1ac771f">parse_calibration_correction_file</a> (uint32_t gpstime, calibration *cal)</td></tr>
<tr class="memdesc:a8f042bf36cfe2928b7fcbde7b1ac771f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parses the PQ phase correction for the given GPS time from the file <code>pq_phase_correction.txt</code>.  <a href="calibration_8c.html#a8f042bf36cfe2928b7fcbde7b1ac771f">More...</a><br /></td></tr>
<tr class="separator:a8f042bf36cfe2928b7fcbde7b1ac771f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1747181121fba13c88fdee4ce3de502d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#a1747181121fba13c88fdee4ce3de502d">vmApplyCalibrationCorrections</a> (vcsbeam_context *vm)</td></tr>
<tr class="memdesc:a1747181121fba13c88fdee4ce3de502d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Applies various corrections/adjustments to the calibration solutions.  <a href="calibration_8c.html#a1747181121fba13c88fdee4ce3de502d">More...</a><br /></td></tr>
<tr class="separator:a1747181121fba13c88fdee4ce3de502d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7410cedec986a96d46d8e7f96a4ff59e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#a7410cedec986a96d46d8e7f96a4ff59e">vmParseFlaggedTilenamesFile</a> (char *filename, calibration *cal)</td></tr>
<tr class="memdesc:a7410cedec986a96d46d8e7f96a4ff59e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse the flagged tile names in the given file.  <a href="calibration_8c.html#a7410cedec986a96d46d8e7f96a4ff59e">More...</a><br /></td></tr>
<tr class="separator:a7410cedec986a96d46d8e7f96a4ff59e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a543e51ef2f611d71f6ae13eef2f0b1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#a2a543e51ef2f611d71f6ae13eef2f0b1">tilename_is_flagged</a> (char *tilename, calibration *cal)</td></tr>
<tr class="memdesc:a2a543e51ef2f611d71f6ae13eef2f0b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tests whether a tile with the given tilename has been flagged.  <a href="calibration_8c.html#a2a543e51ef2f611d71f6ae13eef2f0b1">More...</a><br /></td></tr>
<tr class="separator:a2a543e51ef2f611d71f6ae13eef2f0b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad565f8bc38128d7645a55be24697ee6f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#ad565f8bc38128d7645a55be24697ee6f">vmSetCustomTileFlags</a> (vcsbeam_context *vm)</td></tr>
<tr class="memdesc:ad565f8bc38128d7645a55be24697ee6f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flags tiles by setting the corresponding calibration matrices to zero.  <a href="calibration_8c.html#ad565f8bc38128d7645a55be24697ee6f">More...</a><br /></td></tr>
<tr class="separator:ad565f8bc38128d7645a55be24697ee6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7128d4f3d1d8a67d682496a17cb472d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#af7128d4f3d1d8a67d682496a17cb472d">init_calibration</a> (calibration *cal)</td></tr>
<tr class="memdesc:af7128d4f3d1d8a67d682496a17cb472d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the member variables of the given calibration struct to their default values.  <a href="calibration_8c.html#af7128d4f3d1d8a67d682496a17cb472d">More...</a><br /></td></tr>
<tr class="separator:af7128d4f3d1d8a67d682496a17cb472d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7eeefa8baa1be81f320a5540d7f69c4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="calibration_8c.html#ad7eeefa8baa1be81f320a5540d7f69c4">free_calibration</a> (calibration *cal)</td></tr>
<tr class="memdesc:ad7eeefa8baa1be81f320a5540d7f69c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees the memory associated with a calibration struct.  <a href="calibration_8c.html#ad7eeefa8baa1be81f320a5540d7f69c4">More...</a><br /></td></tr>
<tr class="separator:ad7eeefa8baa1be81f320a5540d7f69c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad7eeefa8baa1be81f320a5540d7f69c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7eeefa8baa1be81f320a5540d7f69c4">&#9670;&nbsp;</a></span>free_calibration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_calibration </td>
          <td>(</td>
          <td class="paramtype">calibration *&#160;</td>
          <td class="paramname"><em>cal</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees the memory associated with a calibration struct. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cal</td><td>The calibration struct to be freed</td></tr>
  </table>
  </dd>
</dl>
<p>This function frees memory associated with <code>cal</code>, but not <code>cal</code> itself. </p>

</div>
</div>
<a id="af7128d4f3d1d8a67d682496a17cb472d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7128d4f3d1d8a67d682496a17cb472d">&#9670;&nbsp;</a></span>init_calibration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init_calibration </td>
          <td>(</td>
          <td class="paramtype">calibration *&#160;</td>
          <td class="paramname"><em>cal</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets the member variables of the given calibration struct to their default values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cal</td><td>A pointer to the calibration struct to be initialised </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8f042bf36cfe2928b7fcbde7b1ac771f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f042bf36cfe2928b7fcbde7b1ac771f">&#9670;&nbsp;</a></span>parse_calibration_correction_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void parse_calibration_correction_file </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>gpstime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">calibration *&#160;</td>
          <td class="paramname"><em>cal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parses the PQ phase correction for the given GPS time from the file <code>pq_phase_correction.txt</code>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">gpstime</td><td>The GPS second to search for </td></tr>
    <tr><td class="paramname">cal</td><td>The calibration struct to store the read-in information </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad66159c79c4179391e06774105799bfe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad66159c79c4179391e06774105799bfe">&#9670;&nbsp;</a></span>read_bandpass_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void read_bandpass_file </td>
          <td>(</td>
          <td class="paramtype">cuDoubleComplex ***&#160;</td>
          <td class="paramname"><em>Jm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cuDoubleComplex ***&#160;</td>
          <td class="paramname"><em>Jf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">MetafitsMetadata *&#160;</td>
          <td class="paramname"><em>cal_metadata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>filename</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads an RTS Bandpass file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">Jm</td><td>A buffer for the measured matrices, <img class="formulaInl" alt="${\bf J}_m$" src="form_92.svg"/> </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Jf</td><td>A buffer for the fitted matrices, <img class="formulaInl" alt="${\bf J}_f$" src="form_93.svg"/> </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">cal_metadata</td><td>The metadata struct for the calibration observation </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">filename</td><td>The name of the Bandpass file to be read</td></tr>
  </table>
  </dd>
</dl>
<p>This function populates the <img class="formulaInl" alt="${\bf J}_m$" src="form_92.svg"/> and <img class="formulaInl" alt="${\bf J}_f$" src="form_93.svg"/> arrays with values read in from the given Bandpass file. The Bandpass files contain only values for antennas and fine channels that have not been flagged. Nothing is done for those antennas/channels that have been flagged, so the onus is on the caller to initialise the <img class="formulaInl" alt="${\bf J}_m$" src="form_92.svg"/> and <img class="formulaInl" alt="${\bf J}_f$" src="form_93.svg"/> arrays to values to their preferred values. </p>

</div>
</div>
<a id="a5a248707c3daf7f72727671c430e6aa9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a248707c3daf7f72727671c430e6aa9">&#9670;&nbsp;</a></span>read_dijones_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void read_dijones_file </td>
          <td>(</td>
          <td class="paramtype">cuDoubleComplex **&#160;</td>
          <td class="paramname"><em>Dd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cuDoubleComplex *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>amp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>nant</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>fname</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads in an RTS DIJones file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">Dd</td><td>The buffer to store the read-in matrices </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">A</td><td>The buffer to store the alignment matrix </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">amp</td><td>A (single-element) buffer to store the calibration amplitude </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nant</td><td>The number of antennas to read in </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">fname</td><td>The name of the file to read</td></tr>
  </table>
  </dd>
</dl>
<p>Read in an RTS file and return the direction independent Jones matrix for each antenna. This implements Eq. (29) in Ord et al. (2019).</p>
<p>This function assumes that the RTS "DIJones" files are in a very specific format. However, this code is maintained independently from the RTS, so if the RTS changes, this code may break. </p>

</div>
</div>
<a id="a6360897603b35d1dfe68032a20b19079"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6360897603b35d1dfe68032a20b19079">&#9670;&nbsp;</a></span>remove_reference_phase()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void remove_reference_phase </td>
          <td>(</td>
          <td class="paramtype">cuDoubleComplex *&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cuDoubleComplex *&#160;</td>
          <td class="paramname"><em>Jref</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Rotates the phases of the elements of a complex matrix with respect to a reference matrix. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">J</td><td>The matrix whose phases are to be rotated, <img class="formulaInl" alt="${\bf J}$" src="form_41.svg"/> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Jref</td><td>The reference matrix, <img class="formulaInl" alt="${\bf J}_\text{ref}$" src="form_94.svg"/></td></tr>
  </table>
  </dd>
</dl>
<p>Each element in <img class="formulaInl" alt="${\bf J}$" src="form_41.svg"/> is divided by the corresponding element in <img class="formulaInl" alt="${\bf J}_\text{ref}$" src="form_94.svg"/>, normalised to unit magnitude. That is, if </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{aligned} {\bf J} &amp;= \begin{bmatrix} J_0 &amp; J_1 \\ J_2 &amp; J_3 \end{bmatrix}, &amp; {\bf J}_\text{ref} &amp;= \begin{bmatrix} J_{\text{ref},0} &amp; J_{\text{ref},1} \\ J_{\text{ref},2} &amp; J_{\text{ref},3} \end{bmatrix}, \end{aligned} \]" src="form_95.svg"/>
</p>
<p> then this function computes </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{bmatrix} J_0\frac{|J_{\text{ref},0}|}{J_{\text{ref},0}} &amp; J_1\frac{|J_{\text{ref},1}|}{J_{\text{ref},1}} \\ J_2\frac{|J_{\text{ref},2}|}{J_{\text{ref},2}} &amp; J_3\frac{|J_{\text{ref},3}|}{J_{\text{ref},3}}. \end{bmatrix} \]" src="form_96.svg"/>
</p>
<p>This operation does not affect the magnitudes of the elements of <img class="formulaInl" alt="${\bf J}$" src="form_41.svg"/>, but only their phases. </p>

</div>
</div>
<a id="a2a543e51ef2f611d71f6ae13eef2f0b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a543e51ef2f611d71f6ae13eef2f0b1">&#9670;&nbsp;</a></span>tilename_is_flagged()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool tilename_is_flagged </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>tilename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">calibration *&#160;</td>
          <td class="paramname"><em>cal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tests whether a tile with the given tilename has been flagged. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tilename</td><td>The tile name whose flagged status is sought </td></tr>
    <tr><td class="paramname">cal</td><td>The calibration struct containing the list of flagged tiles</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if an only if the tile with the given tilename is flagged in in <code>cal</code> </dd></dl>

</div>
</div>
<a id="a1747181121fba13c88fdee4ce3de502d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1747181121fba13c88fdee4ce3de502d">&#9670;&nbsp;</a></span>vmApplyCalibrationCorrections()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmApplyCalibrationCorrections </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Applies various corrections/adjustments to the calibration solutions. </p>
<p>This function applies to the calibration solutions given in <code>vm&rarr;D</code>. The corrections to be applied are taken from the calibration struct <code>vm&rarr;cal</code>.</p>
<p>Three (optional) corrections are applied:</p><ol type="1">
<li>Subtract the phases from each antenna by a reference antenna (see <a class="el" href="calibration_8c.html#a6360897603b35d1dfe68032a20b19079" title="Rotates the phases of the elements of a complex matrix with respect to a reference matrix.">remove_reference_phase()</a>).</li>
<li>Remove the PQ and QP (i.e. off-diagonal) terms (see <a class="el" href="calibration_8c.html#a8075cee8c51e05b8157a772f3fb10ebc" title="Zeroes the off-diagonal terms of the given matrix.">zero_PQ_and_QP()</a>).</li>
<li>Apply a phase slope to the QQ terms (implemented in this function). </li>
</ol>

</div>
</div>
<a id="a20eb84ad9699d8bc39c5f0001cf6b246"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20eb84ad9699d8bc39c5f0001cf6b246">&#9670;&nbsp;</a></span>vmLoadOffringaSolution()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmLoadOffringaSolution </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads in a calibration solution from an Offringa-style solution file. </p>
<p>A full description of the Offringa file format can be found <a class="el" href="fileformats.html#offringafileformat">here</a>.</p>
<p>The input file is taken from <code>vm&rarr;cal.caldir</code>.</p>
<p>Only the coarse channel specified in <code>vm&rarr;coarse_chan_idx</code> will be read in.</p>
<p>This function assumes that memory for the Jones matrices (D) has already been allocated. </p>

</div>
</div>
<a id="a456923a16ff4f680b225d49d7e5ebe63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a456923a16ff4f680b225d49d7e5ebe63">&#9670;&nbsp;</a></span>vmLoadRTSSolution()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmLoadRTSSolution </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Loads a Real Time System (RTS) calibration solution. </p>
<dl class="section return"><dt>Returns</dt><dd>An array of Jones matrices (<code>vm&rarr;D</code>)</dd></dl>
<p>Reads in the RTS solution from the DI_Jones and Bandpass files in the <code>vm&rarr;cal.caldir</code> directory. It only reads the solution for the coarse channel specified in <code>vm&rarr;coarse_chan_idxs_to_process[0]</code>. Flagged channels and flagged antennas are set to zero.</p>
<p>The Jones matrices, <img class="formulaInl" alt="$D$" src="form_87.svg"/>, are output in the <img class="formulaInl" alt="$(Q,P)$" src="form_88.svg"/> basis: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[\begin{bmatrix} D_{qq} &amp; D_{qp} \\ D_{pq} &amp; D_{pp} \end{bmatrix}.\]" src="form_89.svg"/>
</p>
<p>The RTS bandpass solutions ("Bandpass...") are included if <code>vm&rarr;cal.use_bandpass</code> is set, otherwise only the coarse channel solutions ("DI_Jones...") are used.</p>
<p>This function assumes that a buffer for <code>vm&rarr;D</code> has already been allocated.</p>
<p>The RTS matrices are actually given in the <img class="formulaInl" alt="$(P,Q)$" src="form_90.svg"/>, and this function reorders the matrices to be in the <img class="formulaInl" alt="$(Q,P)$" src="form_88.svg"/> basis, required by VCSBeam: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{bmatrix} D_{pp} &amp; D_{pq} \\ D_{qp} &amp; D_{qq} \end{bmatrix} \rightarrow \begin{bmatrix} D_{qq} &amp; D_{qp} \\ D_{pq} &amp; D_{pp} \end{bmatrix} \]" src="form_91.svg"/>
</p>
<p> This reording is a "reversal" of the matrix elements (i.e. if one reads the elements from left to right, top to bottom).</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="calibration.html#rts">RTS</a> </dd>
<dd>
<a class="el" href="fileformats.html#rtsfileformat">RTS file format</a> </dd></dl>

</div>
</div>
<a id="a7410cedec986a96d46d8e7f96a4ff59e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7410cedec986a96d46d8e7f96a4ff59e">&#9670;&nbsp;</a></span>vmParseFlaggedTilenamesFile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmParseFlaggedTilenamesFile </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">calibration *&#160;</td>
          <td class="paramname"><em>cal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse the flagged tile names in the given file. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>The name of the file to be parsed </td></tr>
    <tr><td class="paramname">cal</td><td>The calibration struct where to store the parsed information </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad565f8bc38128d7645a55be24697ee6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad565f8bc38128d7645a55be24697ee6f">&#9670;&nbsp;</a></span>vmSetCustomTileFlags()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmSetCustomTileFlags </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Flags tiles by setting the corresponding calibration matrices to zero. </p>
<p>If <code>vm&rarr;cal.flags_file</code> has been set, this function parses it (by calling <a class="el" href="calibration_8c.html#a7410cedec986a96d46d8e7f96a4ff59e" title="Parse the flagged tile names in the given file.">vmParseFlaggedTilenamesFile()</a>), and then sets all of the calibration solutions for the named tiles to zero. Afterwards, <a class="el" href="metadata_8c.html#acdd91a3f5247af33189f1effe62aa0db" title="Counts the number of tiles that are not flagged.">vmSetNumNotFlaggedRFInputs()</a> is called. </p>

</div>
</div>
<a id="a8075cee8c51e05b8157a772f3fb10ebc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8075cee8c51e05b8157a772f3fb10ebc">&#9670;&nbsp;</a></span>zero_PQ_and_QP()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void zero_PQ_and_QP </td>
          <td>(</td>
          <td class="paramtype">cuDoubleComplex *&#160;</td>
          <td class="paramname"><em>J</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Zeroes the off-diagonal terms of the given matrix. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">J</td><td>A complex-valued 2x2 matrix, <img class="formulaInl" alt="${\bf J}$" src="form_41.svg"/></td></tr>
  </table>
  </dd>
</dl>
<p>This function sets the off-diagonal terms to zero, thus: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf J} = \begin{bmatrix} J_0 &amp; J_1 \\ J_2 &amp; J_3 \end{bmatrix} \rightarrow \begin{bmatrix} J_0 &amp; 0 \\ 0 &amp; J_3 \end{bmatrix}. \]" src="form_97.svg"/>
</p>
 
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
