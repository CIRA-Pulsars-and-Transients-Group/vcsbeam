<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VCSBeam: primary_beam.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VCSBeam
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">primary_beam.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;cuComplex.h&gt;</code><br />
<code>#include &lt;mwalib.h&gt;</code><br />
<code>#include &lt;mwa_hyperbeam.h&gt;</code><br />
<code>#include &quot;vcsbeam.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for primary_beam.c:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="primary__beam_8c__incl.svg" width="100%" height="384"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a7bf5e3c410dbaefc131df3c58fe269ce"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#a7bf5e3c410dbaefc131df3c58fe269ce">NCOMPLEXELEMENTS</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a7bf5e3c410dbaefc131df3c58fe269ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a39d7cb51f87c2ee201508a19bb9a8285"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#a39d7cb51f87c2ee201508a19bb9a8285">vmCalcB</a> (vcsbeam_context *vm, beam_geom *beam_geom_vals)</td></tr>
<tr class="memdesc:a39d7cb51f87c2ee201508a19bb9a8285"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the beam model Jones matrices for the given pointings.  <a href="primary__beam_8c.html#a39d7cb51f87c2ee201508a19bb9a8285">More...</a><br /></td></tr>
<tr class="separator:a39d7cb51f87c2ee201508a19bb9a8285"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b05c0aa7ccd995a5c7262829e5f84cf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#a4b05c0aa7ccd995a5c7262829e5f84cf">vmCreatePrimaryBeam</a> (vcsbeam_context *vm)</td></tr>
<tr class="memdesc:a4b05c0aa7ccd995a5c7262829e5f84cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates memory for the beam model Jones matrices.  <a href="primary__beam_8c.html#a4b05c0aa7ccd995a5c7262829e5f84cf">More...</a><br /></td></tr>
<tr class="separator:a4b05c0aa7ccd995a5c7262829e5f84cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66bac3aed1ef85141bf50bb9bca118f3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#a66bac3aed1ef85141bf50bb9bca118f3">free_primary_beam</a> (primary_beam *pb)</td></tr>
<tr class="memdesc:a66bac3aed1ef85141bf50bb9bca118f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees the memory allocated in <a class="el" href="primary__beam_8c.html#a4b05c0aa7ccd995a5c7262829e5f84cf" title="Allocates memory for the beam model Jones matrices.">vmCreatePrimaryBeam()</a>  <a href="primary__beam_8c.html#a66bac3aed1ef85141bf50bb9bca118f3">More...</a><br /></td></tr>
<tr class="separator:a66bac3aed1ef85141bf50bb9bca118f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfadd7431369faf082a54795fac0b5cd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#adfadd7431369faf082a54795fac0b5cd">create_delays_amps_from_metafits</a> (MetafitsMetadata *obs_metadata, uint32_t ***delays, double ***amps)</td></tr>
<tr class="memdesc:adfadd7431369faf082a54795fac0b5cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructs "delay" and "amp" arrays required by Hyperbeam.  <a href="primary__beam_8c.html#adfadd7431369faf082a54795fac0b5cd">More...</a><br /></td></tr>
<tr class="separator:adfadd7431369faf082a54795fac0b5cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca3a3b8084b6b8cb82e9385408c0a162"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#aca3a3b8084b6b8cb82e9385408c0a162">free_delays_amps</a> (MetafitsMetadata *obs_metadata, uint32_t **delays, double **amps)</td></tr>
<tr class="memdesc:aca3a3b8084b6b8cb82e9385408c0a162"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees the memory allocated in <a class="el" href="primary__beam_8c.html#adfadd7431369faf082a54795fac0b5cd" title="Constructs &quot;delay&quot; and &quot;amp&quot; arrays required by Hyperbeam.">create_delays_amps_from_metafits()</a>.  <a href="primary__beam_8c.html#aca3a3b8084b6b8cb82e9385408c0a162">More...</a><br /></td></tr>
<tr class="separator:aca3a3b8084b6b8cb82e9385408c0a162"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abed728c1e058dd6b81dd9771b431a2c1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#abed728c1e058dd6b81dd9771b431a2c1">hash_dipole_config</a> (double *amps)</td></tr>
<tr class="memdesc:abed728c1e058dd6b81dd9771b431a2c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implements a hash lookup for dead/live dipole configurations.  <a href="primary__beam_8c.html#abed728c1e058dd6b81dd9771b431a2c1">More...</a><br /></td></tr>
<tr class="separator:abed728c1e058dd6b81dd9771b431a2c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdec646d89aec813e571bb5a2b64612f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#afdec646d89aec813e571bb5a2b64612f">parallactic_angle_correction</a> (double *Ppa, double lat, double az, double za)</td></tr>
<tr class="memdesc:afdec646d89aec813e571bb5a2b64612f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the parallactic angle correction matrix, <img class="formulaInl" alt="${\bf P}_\text{pa}$" src="form_173.svg"/>.  <a href="primary__beam_8c.html#afdec646d89aec813e571bb5a2b64612f">More...</a><br /></td></tr>
<tr class="separator:afdec646d89aec813e571bb5a2b64612f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07d76803151480bdee46ceb53fd93d74"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#a07d76803151480bdee46ceb53fd93d74">calc_normalised_beam_response</a> (FEEBeam *beam, double az, double za, double freq_hz, uint32_t *delays, double *amps, double *IQUV, cuDoubleComplex **J, bool apply_pa_correction)</td></tr>
<tr class="memdesc:a07d76803151480bdee46ceb53fd93d74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the normalised primary beam response to a Stokes I, Q, U, or V sky.  <a href="primary__beam_8c.html#a07d76803151480bdee46ceb53fd93d74">More...</a><br /></td></tr>
<tr class="separator:a07d76803151480bdee46ceb53fd93d74"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa4ebd5848b98c1cf4465948643689007"><td class="memItemLeft" align="right" valign="top">const double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#aa4ebd5848b98c1cf4465948643689007">Isky</a> [] = { 0.5, 0. , 0. , 0. , 0. , 0. , 0.5, 0. }</td></tr>
<tr class="memdesc:aa4ebd5848b98c1cf4465948643689007"><td class="mdescLeft">&#160;</td><td class="mdescRight">The coherency matrix for a pure Stokes I sky.  <a href="primary__beam_8c.html#aa4ebd5848b98c1cf4465948643689007">More...</a><br /></td></tr>
<tr class="separator:aa4ebd5848b98c1cf4465948643689007"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae37edf3b0b6c65691da0f8815fc0ed8f"><td class="memItemLeft" align="right" valign="top">const double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#ae37edf3b0b6c65691da0f8815fc0ed8f">Qsky</a> [] = { 0.5, 0. , 0. , 0. , 0. , 0. , -0.5, 0. }</td></tr>
<tr class="memdesc:ae37edf3b0b6c65691da0f8815fc0ed8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">The coherency matrix for a pure Stokes Q sky.  <a href="primary__beam_8c.html#ae37edf3b0b6c65691da0f8815fc0ed8f">More...</a><br /></td></tr>
<tr class="separator:ae37edf3b0b6c65691da0f8815fc0ed8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4dbbcdc2f67633b88b3af50d727dd10e"><td class="memItemLeft" align="right" valign="top">const double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#a4dbbcdc2f67633b88b3af50d727dd10e">Usky</a> [] = { 0. , 0. , 0.5, 0. , 0.5, 0. , 0. , 0. }</td></tr>
<tr class="memdesc:a4dbbcdc2f67633b88b3af50d727dd10e"><td class="mdescLeft">&#160;</td><td class="mdescRight">The coherency matrix for a pure Stokes U sky.  <a href="primary__beam_8c.html#a4dbbcdc2f67633b88b3af50d727dd10e">More...</a><br /></td></tr>
<tr class="separator:a4dbbcdc2f67633b88b3af50d727dd10e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad070a63d38129edfe4c274fa98463be8"><td class="memItemLeft" align="right" valign="top">const double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#ad070a63d38129edfe4c274fa98463be8">Vsky</a> [] = { 0. , 0. , 0. , -0.5, 0 , 0.5, 0. , 0. }</td></tr>
<tr class="memdesc:ad070a63d38129edfe4c274fa98463be8"><td class="mdescLeft">&#160;</td><td class="mdescRight">The coherency matrix for a pure Stokes V sky.  <a href="primary__beam_8c.html#ad070a63d38129edfe4c274fa98463be8">More...</a><br /></td></tr>
<tr class="separator:ad070a63d38129edfe4c274fa98463be8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c6e931508e2907ad22c4188bd8c4ec3"><td class="memItemLeft" align="right" valign="top">const double *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="primary__beam_8c.html#a7c6e931508e2907ad22c4188bd8c4ec3">sky</a> [] = { <a class="el" href="primary__beam_8c.html#aa4ebd5848b98c1cf4465948643689007">Isky</a>, <a class="el" href="primary__beam_8c.html#ae37edf3b0b6c65691da0f8815fc0ed8f">Qsky</a>, <a class="el" href="primary__beam_8c.html#a4dbbcdc2f67633b88b3af50d727dd10e">Usky</a>, <a class="el" href="primary__beam_8c.html#ad070a63d38129edfe4c274fa98463be8">Vsky</a> }</td></tr>
<tr class="memdesc:a7c6e931508e2907ad22c4188bd8c4ec3"><td class="mdescLeft">&#160;</td><td class="mdescRight">The set of coherency matrices for pure Stokes I, Q, U, and V skies.  <a href="primary__beam_8c.html#a7c6e931508e2907ad22c4188bd8c4ec3">More...</a><br /></td></tr>
<tr class="separator:a7c6e931508e2907ad22c4188bd8c4ec3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a7bf5e3c410dbaefc131df3c58fe269ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7bf5e3c410dbaefc131df3c58fe269ce">&#9670;&nbsp;</a></span>NCOMPLEXELEMENTS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NCOMPLEXELEMENTS&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a07d76803151480bdee46ceb53fd93d74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07d76803151480bdee46ceb53fd93d74">&#9670;&nbsp;</a></span>calc_normalised_beam_response()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calc_normalised_beam_response </td>
          <td>(</td>
          <td class="paramtype">FEEBeam *&#160;</td>
          <td class="paramname"><em>beam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>az</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>za</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>freq_hz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>delays</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>amps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>IQUV</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">cuDoubleComplex **&#160;</td>
          <td class="paramname"><em>J</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>apply_pa_correction</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the normalised primary beam response to a Stokes I, Q, U, or V sky. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">beam</td><td>A Hyperbeam object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">az</td><td>The azimuth (radians) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">za</td><td>The zenith angle (radians) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">freq_hz</td><td>The frequency (Hz) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">delays</td><td>The dipole delays that define a primary beam pointing </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">amps</td><td>The dipole amplitudes that define the live/dead configuration </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">IQUV</td><td>The beam response </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">J</td><td>A pointer to the beam model Jones matrix </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">apply_pa_correction</td><td>Whether to apply the parallactic angle correction to <code>J</code></td></tr>
  </table>
  </dd>
</dl>
<p><code>IQUV</code> must point to already-allocated memory with size <img class="formulaInl" alt="$N_s$" src="form_37.svg"/>.</p>
<p>This function will allocate memory for <code>J</code>, which must be freed by the caller. </p>

</div>
</div>
<a id="adfadd7431369faf082a54795fac0b5cd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfadd7431369faf082a54795fac0b5cd">&#9670;&nbsp;</a></span>create_delays_amps_from_metafits()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void create_delays_amps_from_metafits </td>
          <td>(</td>
          <td class="paramtype">MetafitsMetadata *&#160;</td>
          <td class="paramname"><em>obs_metadata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t ***&#160;</td>
          <td class="paramname"><em>delays</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double ***&#160;</td>
          <td class="paramname"><em>amps</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructs "delay" and "amp" arrays required by Hyperbeam. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">obs_metadata</td><td>A MetafitsMetadata object containing the delays and amps. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">delays</td><td>A pointer to an array of delay values, with layout <img class="formulaInl" alt="$N_i \times N_d$" src="form_171.svg"/> </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">amps</td><td>A pointer to an array of amp values, with layout <img class="formulaInl" alt="$N_i \times N_d$" src="form_171.svg"/></td></tr>
  </table>
  </dd>
</dl>
<p>Delays can be brought directly across from the MetafitsMetadata struct. The "conversion" from delays to amps is straightforward: All amps are "1.0" unless the delay is 32, in which case the amp should be "0.0". (The value 32 is the number assigned to a faulty or broken dipole.)</p>
<p>This function allocates memory for both delays and amps. This can be freed by a call to <a class="el" href="primary__beam_8c.html#aca3a3b8084b6b8cb82e9385408c0a162" title="Frees the memory allocated in create_delays_amps_from_metafits().">free_delays_amps()</a>. </p>

</div>
</div>
<a id="aca3a3b8084b6b8cb82e9385408c0a162"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca3a3b8084b6b8cb82e9385408c0a162">&#9670;&nbsp;</a></span>free_delays_amps()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_delays_amps </td>
          <td>(</td>
          <td class="paramtype">MetafitsMetadata *&#160;</td>
          <td class="paramname"><em>obs_metadata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t **&#160;</td>
          <td class="paramname"><em>delays</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double **&#160;</td>
          <td class="paramname"><em>amps</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees the memory allocated in <a class="el" href="primary__beam_8c.html#adfadd7431369faf082a54795fac0b5cd" title="Constructs &quot;delay&quot; and &quot;amp&quot; arrays required by Hyperbeam.">create_delays_amps_from_metafits()</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obs_metadata</td><td>A MetafitsMetadata object </td></tr>
    <tr><td class="paramname">delays</td><td>The array of delay values to be freed </td></tr>
    <tr><td class="paramname">amps</td><td>The array of amp values to be freed</td></tr>
  </table>
  </dd>
</dl>
<p>Here, the MetafitsMetadata is used to find <img class="formulaInl" alt="$N_i$" src="form_172.svg"/> (one of the dimensions of <code>delays</code> and <code>amps</code>). </p>

</div>
</div>
<a id="a66bac3aed1ef85141bf50bb9bca118f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66bac3aed1ef85141bf50bb9bca118f3">&#9670;&nbsp;</a></span>free_primary_beam()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void free_primary_beam </td>
          <td>(</td>
          <td class="paramtype">primary_beam *&#160;</td>
          <td class="paramname"><em>pb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees the memory allocated in <a class="el" href="primary__beam_8c.html#a4b05c0aa7ccd995a5c7262829e5f84cf" title="Allocates memory for the beam model Jones matrices.">vmCreatePrimaryBeam()</a> </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000034">Todo:</a></b></dt><dd>Change name to vm... </dd></dl>

</div>
</div>
<a id="abed728c1e058dd6b81dd9771b431a2c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abed728c1e058dd6b81dd9771b431a2c1">&#9670;&nbsp;</a></span>hash_dipole_config()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int hash_dipole_config </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>amps</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Implements a hash lookup for dead/live dipole configurations. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">amps</td><td>The array of amps whose configuration is to be hashed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The hashed index for this configuration</dd></dl>
<p>In order to avoid recalculating the FEE beam for repeated dipole configurations, we have to keep track of which configurations have already been calculated. We do this through a boolean array, and this function converts dipole configurations into indices of this array. In other words, this function <em>assigns meaning</em> to the array.</p>
<p>Since dead dipoles are relatively rare, we only consider configurations in which up to two dipoles are dead. Any more than that and the we can recalculate the Jones matrix with minimal entropy. In this case, this function returns <code>MANY_DEAD_DIPOLES</code>. The other remaining cases are:</p>
<ul>
<li>0 dead dipoles = 1 configuration</li>
<li>1 dead dipole = 16 configurations</li>
<li>2 dead dipoles = 120 configurations</li>
<li>16 dead dipoles = 1 configuration</li>
</ul>
<p>for a grand total of 138 indices. They are ordered as follows: </p><div class="fragment"><div class="line">idx  configuration (0=dead, 1=live)</div>
<div class="line"> 0   [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</div>
<div class="line"> 1   [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</div>
<div class="line"> 2   [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</div>
<div class="line"> 3   [1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</div>
<div class="line"> ...</div>
<div class="line"> 16  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0]</div>
<div class="line"> 17  [0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</div>
<div class="line"> 18  [0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</div>
<div class="line"> 19  [0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</div>
<div class="line"> ...</div>
<div class="line"> 31  [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0]</div>
<div class="line"> 32  [1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</div>
<div class="line"> 33  [1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]</div>
<div class="line"> ...</div>
<div class="line"> 135 [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0]</div>
<div class="line"> 136 [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0]</div>
<div class="line"> 137 [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</div>
</div><!-- fragment --><p>This function defines "dead" as amps=0.0, "live" otherwise. </p>

</div>
</div>
<a id="afdec646d89aec813e571bb5a2b64612f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdec646d89aec813e571bb5a2b64612f">&#9670;&nbsp;</a></span>parallactic_angle_correction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void parallactic_angle_correction </td>
          <td>(</td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>Ppa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>lat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>az</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>za</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the parallactic angle correction matrix, <img class="formulaInl" alt="${\bf P}_\text{pa}$" src="form_173.svg"/>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">Ppa</td><td>The output rotation matrix </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">lat</td><td>The observing latitude (radians) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">az</td><td>The azimuth angle (radians) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">za</td><td>The zenith angle (radians)</td></tr>
  </table>
  </dd>
</dl>
<p>This function computes the parallactic angle correction matrix in the basis (see <a class="el" href="definitions.html#parallacticangle">Parallactic angle correction</a>): </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf P}_\text{pa} = \begin{bmatrix} P_{\theta x} &amp; P_{\theta y} \\ P_{\phi x} &amp; P_{\phi y} \end{bmatrix}. \]" src="form_174.svg"/>
</p>
 
</div>
</div>
<a id="a39d7cb51f87c2ee201508a19bb9a8285"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39d7cb51f87c2ee201508a19bb9a8285">&#9670;&nbsp;</a></span>vmCalcB()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmCalcB </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">beam_geom *&#160;</td>
          <td class="paramname"><em>beam_geom_vals</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the beam model Jones matrices for the given pointings. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vm</td><td>The VCSBeam context struct </td></tr>
    <tr><td class="paramname">beam_geom_vals</td><td>An array of beam_geom objects containing the pointing information</td></tr>
  </table>
  </dd>
</dl>
<p>This function uses Hyperbeam to calculate the beam model Jones matrices for each pointing in <code>beam_geom_vals</code>.</p>
<p>Only those configurations of live (i.e. non-dead) dipoles which exist in the array are calculated, in order to save calculation time.</p>
<p>The parallactic angle correction is applied, so that the final matrices, which are stored in <code>pb&rarr;B</code>, are in the basis </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf B} = \begin{bmatrix} B_{qx} &amp; B_{qy} \\ B_{px} &amp; B_{py} \end{bmatrix}. \]" src="form_169.svg"/>
</p>
 
</div>
</div>
<a id="a4b05c0aa7ccd995a5c7262829e5f84cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b05c0aa7ccd995a5c7262829e5f84cf">&#9670;&nbsp;</a></span>vmCreatePrimaryBeam()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void vmCreatePrimaryBeam </td>
          <td>(</td>
          <td class="paramtype">vcsbeam_context *&#160;</td>
          <td class="paramname"><em>vm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates memory for the beam model Jones matrices. </p>
<p>The resulting array (<code>vm&rarr;B</code>) has dimensions <img class="formulaInl" alt="$N_b \times N_a \times N_p \times N_p$" src="form_170.svg"/>. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aa4ebd5848b98c1cf4465948643689007"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4ebd5848b98c1cf4465948643689007">&#9670;&nbsp;</a></span>Isky</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const double Isky[] = { 0.5, 0. , 0. , 0. , 0. , 0. , 0.5, 0. }</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The coherency matrix for a pure Stokes I sky. </p>

</div>
</div>
<a id="ae37edf3b0b6c65691da0f8815fc0ed8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae37edf3b0b6c65691da0f8815fc0ed8f">&#9670;&nbsp;</a></span>Qsky</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const double Qsky[] = { 0.5, 0. , 0. , 0. , 0. , 0. , -0.5, 0. }</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The coherency matrix for a pure Stokes Q sky. </p>

</div>
</div>
<a id="a7c6e931508e2907ad22c4188bd8c4ec3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c6e931508e2907ad22c4188bd8c4ec3">&#9670;&nbsp;</a></span>sky</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const double* sky[] = { <a class="el" href="primary__beam_8c.html#aa4ebd5848b98c1cf4465948643689007">Isky</a>, <a class="el" href="primary__beam_8c.html#ae37edf3b0b6c65691da0f8815fc0ed8f">Qsky</a>, <a class="el" href="primary__beam_8c.html#a4dbbcdc2f67633b88b3af50d727dd10e">Usky</a>, <a class="el" href="primary__beam_8c.html#ad070a63d38129edfe4c274fa98463be8">Vsky</a> }</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The set of coherency matrices for pure Stokes I, Q, U, and V skies. </p>

</div>
</div>
<a id="a4dbbcdc2f67633b88b3af50d727dd10e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4dbbcdc2f67633b88b3af50d727dd10e">&#9670;&nbsp;</a></span>Usky</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const double Usky[] = { 0. , 0. , 0.5, 0. , 0.5, 0. , 0. , 0. }</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The coherency matrix for a pure Stokes U sky. </p>

</div>
</div>
<a id="ad070a63d38129edfe4c274fa98463be8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad070a63d38129edfe4c274fa98463be8">&#9670;&nbsp;</a></span>Vsky</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const double Vsky[] = { 0. , 0. , 0. , -0.5, 0 , 0.5, 0. , 0. }</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The coherency matrix for a pure Stokes V sky. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
