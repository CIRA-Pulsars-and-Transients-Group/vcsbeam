<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VCSBeam: User&#39;s Guide &ndash; Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_tiny.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VCSBeam
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">User's Guide &ndash; Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md49">Observation 1320499816</a></li>
<li class="level1"><a href="#autotoc_md50">Calibration (using Hyperdrive)</a><ul><li class="level2"><a href="#autotoc_md51">Producing a solution</a></li>
<li class="level2"><a href="#autotoc_md52">Plot the solutions</a></li>
<li class="level2"><a href="#autotoc_md53">Convert the solutions</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md54">Beamforming</a><ul><li class="level2"><a href="#autotoc_md55">All 24 channels</a></li>
<li class="level2"><a href="#autotoc_md56">A good single pulse for testing purposes</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md57">Other processes</a><ul><li class="level2"><a href="#autotoc_md58">Offline FinePFB</a></li>
<li class="level2"><a href="#autotoc_md59">Legacy Offline Correlator</a></li>
<li class="level2"><a href="#autotoc_md60">RTS (failed!)</a><ul><li class="level3"><a href="#autotoc_md61">Create source list</a></li>
<li class="level3"><a href="#autotoc_md62">Set up initial RTS job</a></li>
<li class="level3"><a href="#autotoc_md63">Run the RTS</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md64">Incoherent Beam</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_UsersGuide_Examples"></a></p>
<h1><a class="anchor" id="autotoc_md49"></a>
Observation 1320499816</h1>
<p>This example was made using VCSBeam v4.0.0.</p>
<div class="fragment"><div class="line"># On Garrawarla, test vcsbeam version</div>
<div class="line">$ module use /pawsey/mwa/software/python3/modulefiles</div>
<div class="line">$ module load vcsbeam</div>
<div class="line">$ make_mwa_tied_array_beam -V</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md50"></a>
Calibration (using Hyperdrive)</h1>
<h2><a class="anchor" id="autotoc_md51"></a>
Producing a solution</h2>
<dl class="section warning"><dt>Warning</dt><dd>{See <a href="https://mwatelescope.github.io/mwa_hyperdrive/user/intro.html">the hyperdrive documentation</a> for the most up-to-date information.}</dd></dl>
<div class="fragment"><div class="line">$ cd /astro/mwavcs/vcs/1320499816/cal/1320412440/hyperdrive</div>
<div class="line">$ sbatch hyperdrive.sbatch</div>
</div><!-- fragment --><p><b>hyperdrive.sbatch</b>: </p><div class="fragment"><div class="line">#!/bin/bash -l</div>
<div class="line">#SBATCH --job-name=hyp-$1</div>
<div class="line">#SBATCH --output=hyperdrive.out</div>
<div class="line">#SBATCH --nodes=1</div>
<div class="line">#SBATCH --ntasks-per-node=40</div>
<div class="line">#SBATCH --time=01:00:00</div>
<div class="line">#SBATCH --clusters=garrawarla</div>
<div class="line">#SBATCH --partition=gpuq</div>
<div class="line">#SBATCH --account=mwavcs</div>
<div class="line">#SBATCH --export=NONE</div>
<div class="line">#SBATCH --gres=tmp:50g</div>
<div class="line">#SBATCH --gres=gpu:1</div>
<div class="line"> </div>
<div class="line">module use /pawsey/mwa/software/python3/modulefiles</div>
<div class="line">module load hyperdrive</div>
<div class="line"> </div>
<div class="line">set -eux</div>
<div class="line">which hyperdrive</div>
<div class="line"> </div>
<div class="line">#cd /astro/mwaeor/MWA/data/1090008640</div>
<div class="line">METAFITS=/astro/mwavcs/asvo/252007/1320412440.metafits</div>
<div class="line"> </div>
<div class="line">if [[ ! -r srclist_1000.yaml ]]; then</div>
<div class="line">   hyperdrive srclist-by-beam -n 1000 -m ${METAFITS} /pawsey/mwa/software/python3/srclists/master/srclist_pumav3_EoR0aegean_fixedEoR1pietro+ForA_phase1+2.txt srclist_1000.yaml</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line">hyperdrive di-calibrate -s srclist_1000.yaml --tile-flags HexE2 -d /astro/mwavcs/asvo/252007/*.fits ${METAFITS}</div>
</div><!-- fragment --><p>This outputs&#160;hyperdrive_solutions.fits.</p>
<h2><a class="anchor" id="autotoc_md52"></a>
Plot the solutions</h2>
<div class="fragment"><div class="line">hyperdrive solutions-plot -m /astro/mwavcs/asvo/252007/1320412440.metafits hyperdrive_solutions.fits</div>
</div><!-- fragment --><div class="image">
<img src="example_1320499816_phases.png" alt="" width="500px"/>
</div>
 <div class="image">
<img src="example_1320499816_amps.png" alt="" width="500px"/>
</div>
 <h2><a class="anchor" id="autotoc_md53"></a>
Convert the solutions</h2>
<p>Hyperdrive's default is to output the calibration solutions in a FITS format. Currently, VCSBeam only supports RTS and Offringa formats. Hyperdrive includes a utility to convert the solutions into different formats. However, the RTS format is now officially deprecated, and its use is discouraged and <a href="https://MWATelescope.github.io/mwa_hyperdrive/defs/cal_sols.html">not officially supported by hyperdrive</a>.</p>
<p>The conversion to the Offringa format, however, <a href="https://mwatelescope.github.io/mwa_hyperdrive/defs/cal_sols_ao.html">is supported</a>. In this example, this is achieved by </p><div class="fragment"><div class="line">hyperdrive solutions-convert -m /astro/mwavcs/asvo/252007/1320412440.metafits hyperdrive_solutions.fits hyperdrive_solutions.bin</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md54"></a>
Beamforming</h1>
<h2><a class="anchor" id="autotoc_md55"></a>
All 24 channels</h2>
<div class="fragment"></div><!-- fragment --><p><b>pointings.txt</b>: </p><div class="fragment"><div class="line">00:34:08.8703 -07:21:53.409</div>
</div><!-- fragment --><p><b>flagged_tilenames.txt</b>: </p><div class="fragment"><div class="line">HexE2</div>
</div><!-- fragment --><p><b>vcsbeam.sbatch</b>: </p><div class="fragment"><div class="line">#!/bin/bash -l</div>
<div class="line"> </div>
<div class="line">#SBATCH --nodes=1</div>
<div class="line">#SBATCH --ntasks-per-node=1</div>
<div class="line">#SBATCH --cpus-per-task=1</div>
<div class="line">#SBATCH --mem=50gb</div>
<div class="line">#SBATCH --partition=gpuq</div>
<div class="line">#SBATCH --gres=gpu:1</div>
<div class="line">#SBATCH --time=01:00:00</div>
<div class="line">#SBATCH --account=mwavcs</div>
<div class="line">#SBATCH --nice=0</div>
<div class="line">#SBATCH --export=NONE</div>
<div class="line">#SBATCH --array=109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132</div>
<div class="line"> </div>
<div class="line">module use /pawsey/mwa/software/python3/modulefiles</div>
<div class="line">module load vcsbeam/4.1</div>
<div class="line"> </div>
<div class="line">cd /astro/mwavcs/vcs/1320499816/vcsbeam/coh</div>
<div class="line"> </div>
<div class="line"># Download the metafits files</div>
<div class="line">if [ ! -f 1320499816.fits ]; then</div>
<div class="line">    wget -O 1320499816.fits http://ws.mwatelescope.org/metadata/fits?obs_id=1320499816</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line">if [ ! -f 1320412440.fits ]; then</div>
<div class="line">    wget -O 1320412440.fits http://ws.mwatelescope.org/metadata/fits?obs_id=1320412440</div>
<div class="line">fi</div>
<div class="line"> </div>
<div class="line"># Populate pointings file</div>
<div class="line">echo &quot;00:34:08.8703 -07:21:53.409&quot; &gt; pointints.txt</div>
<div class="line"> </div>
<div class="line"># Populate flag tiles file</div>
<div class="line">echo &quot;HexE2&quot; &gt; flagged_tilenames.txt</div>
<div class="line"> </div>
<div class="line">srun -N 1 -n 1 make_mwa_tied_array_beam \</div>
<div class="line">    -m 1320499816.fits \</div>
<div class="line">    -b 1320499824 \</div>
<div class="line">    -T 592 \</div>
<div class="line">    -f ${SLURM_ARRAY_TASK_ID} \</div>
<div class="line">    -d /astro/mwavcs/asvo/252057 \</div>
<div class="line">    -P pointings.txt \</div>
<div class="line">    -F flagged_tilenames.txt \</div>
<div class="line">    -c 1320412440.fits \</div>
<div class="line">    -C hyperdrive_solutions.bin \</div>
<div class="line">    -v -R NONE -U 0,0 -O -X</div>
</div><!-- fragment --><div class="image">
<img src="example_1320499816_presto_24chan.png" alt="" width="500px"/>
</div>
<p>  <em><b>(Needs to be updated)</b></em></p>
<h2><a class="anchor" id="autotoc_md56"></a>
A good single pulse for testing purposes</h2>
<div class="fragment"><div class="line">$ cd /astro/mwavcs/vcs/1320499816/vcsbeam/coh</div>
<div class="line">$ sbatch vcsbeam_single_pulse.sbatch</div>
</div><!-- fragment --><p><b>vcsbeam.sbatch</b>: </p><div class="fragment"><div class="line">#!/bin/bash -l</div>
<div class="line"> </div>
<div class="line">#SBATCH --nodes=24</div>
<div class="line">#SBATCH --ntasks-per-node=1</div>
<div class="line">#SBATCH --cpus-per-task=1</div>
<div class="line">#SBATCH --mem=370gb</div>
<div class="line">#SBATCH --partition=gpuq</div>
<div class="line">#SBATCH --gres=gpu:1</div>
<div class="line">#SBATCH --time=01:00:00</div>
<div class="line">#SBATCH --account=mwavcs</div>
<div class="line">#SBATCH --nice=0</div>
<div class="line">#SBATCH --export=NONE</div>
<div class="line"> </div>
<div class="line">module use /pawsey/mwa/software/python3/modulefiles</div>
<div class="line">module load vcsbeam</div>
<div class="line"> </div>
<div class="line">srun -N 24 -n 24 make_mwa_tied_array_beam \</div>
<div class="line">    -m /astro/mwavcs/vcs/1320499816/vcsbeam/1320499816_legacy.metafits \</div>
<div class="line">    -b 1320500016 \</div>
<div class="line">    -T 1 \</div>
<div class="line">    -f 109 \</div>
<div class="line">    -d /astro/mwavcs/vcs/1320499816/combined \</div>
<div class="line">    -P pointings.txt \</div>
<div class="line">    -F flagged_tilenames.txt \</div>
<div class="line">    -c 1320412440_metafits_ppds.fits \</div>
<div class="line">    -C /astro/mwavcs/vcs/1320499816/cal/1320412440/hyperdrive/hyperdrive_solutions.bin \</div>
<div class="line">    -p -R NONE -U 0,0 -O -X</div>
</div><!-- fragment --><div class="fragment"><div class="line">$ module load singularity</div>
<div class="line">$ /pawsey/mwa/singularity/dspsr/dspsr.sif dspsr -c 1 -D 0 -b 1024 -turns 1 -U 600 -A C001_1320499816_00:34:08.87_-07:21:53.41_ch109-132_0001.fits</div>
<div class="line">$ singularity run -B ~/.Xauthority /pawsey/mwa/singularity/psrchive_tempo2/psrchive_tempo2.sif pav -G -f 4 2021-11-09-13\:29\:57.ar</div>
</div><!-- fragment --> <div class="image">
<img src="example_1320499816_single_pulse.png" alt="" width="500px"/>
</div>
 <h1><a class="anchor" id="autotoc_md57"></a>
Other processes</h1>
<h2><a class="anchor" id="autotoc_md58"></a>
Offline FinePFB</h2>
<div class="fragment"><div class="line">$ cd /astro/mwavcs/asvo/252057</div>
<div class="line">$ wget -O 1320499816.fits http://ws.mwatelescope.org/metadata/fits?obs_id=1320499816</div>
<div class="line">$ cd /astro/mwavcs/vcs/1320499816/combined</div>
<div class="line">$ for freq in {109..132}</div>
<div class="line">do</div>
<div class="line">    sed &quot;s/FREQ/${freq}/&quot; &lt; make_legacy.sbatch &gt; make_legacy_ch${freq}.sbatch</div>
<div class="line">    sbatch make_legacy_ch${freq}.sbatch</div>
<div class="line">done</div>
</div><!-- fragment --><p><b>make_legacy.sbatch</b>: </p><div class="fragment"><div class="line">#!/bin/bash -l</div>
<div class="line"> </div>
<div class="line">#SBATCH --nodes=1</div>
<div class="line">#SBATCH --cpus-per-task=1</div>
<div class="line">#SBATCH --ntasks-per-node=1</div>
<div class="line">#SBATCH --mem=370gb</div>
<div class="line">#SBATCH --partition=gpuq</div>
<div class="line">#SBATCH --gres=gpu:1</div>
<div class="line">#SBATCH --time=01:00:00</div>
<div class="line">#SBATCH --account=mwavcs</div>
<div class="line">#SBATCH --export=NONE</div>
<div class="line"> </div>
<div class="line">module use /pawsey/mwa/software/python3/modulefiles</div>
<div class="line">module load vcsbeam</div>
<div class="line">module load openmpi-ucx-gpu</div>
<div class="line"> </div>
<div class="line">DATAPATH=/astro/mwavcs/asvo/252057</div>
<div class="line"> </div>
<div class="line">srun -N 1 -n 1 fine_pfb_offline -m $DATAPATH/1320499816.metafits -b 1320499816 -T 600 -f FREQ -d $DATAPATH</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md59"></a>
Legacy Offline Correlator</h2>
<p>The legacy offline correlator can be run on recombined files created with Offline Fine PFB.</p>
<div class="fragment"><div class="line">$ cd /astro/mwavcs/vcs/1320499816/cal/1320499816/vis</div>
<div class="line">$ for freq in {109..132}</div>
<div class="line">do</div>
<div class="line">    sed &quot;s/FREQ/${freq}/&quot; &lt; offline_correlate.sbatch &gt; offline_correlate_${freq}.sbatch</div>
<div class="line">    sbatch offline_correlate_${freq}.sbatch</div>
<div class="line">done</div>
</div><!-- fragment --><p><b>offline_correlate.sbatch</b>: </p><div class="fragment"><div class="line">#!/bin/bash -l</div>
<div class="line"> </div>
<div class="line">#SBATCH --nodes=1</div>
<div class="line">#SBATCH --mem=370gb</div>
<div class="line">#SBATCH --partition=gpuq</div>
<div class="line">#SBATCH --gres=gpu:1</div>
<div class="line">#SBATCH --time=01:00:00</div>
<div class="line">#SBATCH --account=mwavcs</div>
<div class="line">#SBATCH --export=NONE</div>
<div class="line"> </div>
<div class="line">module use /pawsey/mwa/software/python3/modulefiles</div>
<div class="line">module load offline_correlator</div>
<div class="line"> </div>
<div class="line">for t in {8..599}</div>
<div class="line">do</div>
<div class="line"> </div>
<div class="line">    gpssecond=$(echo &quot;$t + 1320499816&quot; | bc)</div>
<div class="line">    gpubox=$(echo &quot;FREQ - 108&quot; | bc)</div>
<div class="line"> </div>
<div class="line">    INPUT_DATA_FILE=/astro/mwavcs/vcs/1320499816/combined/1320499816_${gpssecond}_chFREQ.dat</div>
<div class="line">    START_SECOND=${gpssecond}</div>
<div class="line">    DUMPS_PER_SECOND=1 # This sets the output time resolution</div>
<div class="line">                    # (e.g. 20 --&gt; 1/20 = 0.05s = 50 ms)</div>
<div class="line">                    # Minimum allowed resolution is 2 ms</div>
<div class="line">    CHANS_TO_AVERAGE=1 # This sets the output frequency resolution</div>
<div class="line">                   # (e.g. 1 --&gt; 1x10 kHz = 10 kHz)</div>
<div class="line">    GPUBOX_CHANNEL_NUMBER=${gpubox} # This should be chosen to &quot;match&quot; the input channel</div>
<div class="line">                         # This is not easy! (mwalib handles this, but at the</div>
<div class="line">                         # moment, offline_correlator is not using mwalib)</div>
<div class="line">    OUTPUT_PREFIX=1320499816 # Output files begin with this</div>
<div class="line"> </div>
<div class="line">    srun -N 1 -n 1 offline_correlator \</div>
<div class="line">        -d ${INPUT_DATA_FILE} \</div>
<div class="line">        -s ${START_SECOND} \</div>
<div class="line">        -r ${DUMPS_PER_SECOND} \</div>
<div class="line">        -n ${CHANS_TO_AVERAGE} \</div>
<div class="line">        -c ${GPUBOX_CHANNEL_NUMBER} \</div>
<div class="line">        -o ${OUTPUT_PREFIX}</div>
<div class="line"> </div>
<div class="line">done</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md60"></a>
RTS (failed!)</h2>
<h3><a class="anchor" id="autotoc_md61"></a>
Create source list</h3>
<div class="fragment"><div class="line">$ cd /astro/mwavcs/vcs/1320499816/cal/1320499816</div>
<div class="line">$ module load srclists/v1.0.0</div>
<div class="line">$ wget -O 1320499816_metafits_ppds.fits http://ws.mwatelescope.org/metadata/fits?obs_id=1320499816&amp;include_ppds=1</div>
<div class="line">$ srclist_by_beam.py -m 1320499816_metafits_ppds.fits -n 1000 -s ${SRCLISTS_DIR}/srclist_pumav3_EoR0aegean_EoR1pietro+ForA.txt</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md62"></a>
Set up initial RTS job</h3>
<p>First, we need a calibration metafits file (mode = 'HW_LFILES'), which for the moment I edited by hand. It doesn't matter whether the file is one with PPDs or without, but apparently some script somewhere is expected the file to be called <code>obsid_metafits_ppds.fits</code>. So I manually edited the (MWAX VCS) metafits file and just changed the mode, and then made a symbolic link to is called&#160;<code>/astro/mwavcs/vcs/1320499816/cal/1320499816/rts/1320499816_metafits_ppds.fits</code>. Then I ran the script from VCSTools:</p>
<div class="fragment"><div class="line">cd /astro/mwavcs/vcs/1320499816/cal/1320499816/rts</div>
<div class="line">$ calibrate_vcs.py -O 1320499816 -o 1320499816 -m 1320499816_metafits_ppds.fits -s ../srclist_pumav3_EoR0aegean_EoR1pietro+ForA_1320499816_patch1000.txt --offline --nosubmit</div>
</div><!-- fragment --><p> There's no good reason I couldn't have left off the <code>--nosubmit</code> option and had it run, but I just wanted to check it worked before trying it.</p>
<h3><a class="anchor" id="autotoc_md63"></a>
Run the RTS</h3>
<div class="fragment"><div class="line">$ cd /astro/mwavcs/vcs/1320499816/cal/1320499816/rts</div>
<div class="line">$ sbatch /astro/mwavcs/vcs/1320499816/batch/RTS_1320499816.batch</div>
</div><!-- fragment --><p><b>RTS_1320499816.batch</b>: </p><div class="fragment"><div class="line">#!/bin/bash -l</div>
<div class="line"> </div>
<div class="line">#SBATCH --export=NONE</div>
<div class="line">#SBATCH --output=/astro/mwavcs/vcs/1320499816/batch/RTS_1320499816.out</div>
<div class="line">#SBATCH --account=mwavcs</div>
<div class="line">#SBATCH --clusters=garrawarla</div>
<div class="line">#SBATCH --partition=gpuq</div>
<div class="line">#</div>
<div class="line">#SBATCH --cpus-per-task=1</div>
<div class="line">#SBATCH --mem-per-cpu=10240MB</div>
<div class="line">#SBATCH --nice=0</div>
<div class="line">#SBATCH --chdir=/astro/mwavcs/vcs/1320499816/cal/1320499816/rts</div>
<div class="line">#SBATCH --time=0:45:00</div>
<div class="line">#SBATCH --nodes=13</div>
<div class="line">#SBATCH --cpus-per-gpu=1</div>
<div class="line">#SBATCH --gres=gpu:1</div>
<div class="line"> </div>
<div class="line">ncpus=1</div>
<div class="line">export OMP_NUM_THREADS=1</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">module use /pawsey/mwa/software/python3/modulefiles/</div>
<div class="line">module load vcstools/master</div>
<div class="line"> </div>
<div class="line">module load RTS/master</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">cd /astro/mwavcs/vcs/1320499816/cal/1320499816/rts</div>
<div class="line">export UCX_MEMTYPE_CACHE=n</div>
<div class="line">srun --export=all -N 25 -n 25 rts_gpu /astro/mwavcs/vcs/1320499816/cal/1320499816/rts/rts_1320499816.in</div>
</div><!-- fragment --><p><b>rts_1320499816.in</b>: </p><div class="fragment"><div class="line">ReadAllFromSingleFile=</div>
<div class="line">BaseFilename=/astro/mwavcs/vcs/1318345216/cal/1318345216/vis/*_GPUBOX</div>
<div class="line">ReadGpuboxDirect=0</div>
<div class="line">UseCorrelatorInput=1</div>
<div class="line"> </div>
<div class="line">ReadMetafitsFile=1</div>
<div class="line">MetafitsFilename=/astro/mwavcs/vcs/1318345216/1318345216</div>
<div class="line"> </div>
<div class="line">DoCalibration=</div>
<div class="line">doMWArxCorrections=1</div>
<div class="line">doRawDataCorrections=1</div>
<div class="line">doRFIflagging=0</div>
<div class="line">useFastPrimaryBeamModels=0</div>
<div class="line">generateDIjones=1</div>
<div class="line">applyDIcalibration=1</div>
<div class="line">UsePacketInput=0</div>
<div class="line">UseThreadedVI=1</div>
<div class="line"> </div>
<div class="line">MaxFrequency=170.24</div>
<div class="line">ObservationFrequencyBase=138.895</div>
<div class="line">ObservationTimeBase=2455846.1252314816</div>
<div class="line">ObservationPointCentreHA=-0.35952189154909175</div>
<div class="line">ObservationPointCentreDec=-5.98757073636307</div>
<div class="line">ChannelBandwidth=0.04</div>
<div class="line">NumberOfChannels=32</div>
<div class="line"> </div>
<div class="line">CorrDumpsPerCadence=128</div>
<div class="line">CorrDumpTime=1.0</div>
<div class="line">NumberOfIntegrationBins=6</div>
<div class="line">NumberOfIterations=1</div>
<div class="line"> </div>
<div class="line">StartProcessingAt=0</div>
<div class="line"> </div>
<div class="line">ArrayPositionLat=-26.7033194</div>
<div class="line">ArrayPositionLong=116.6708152</div>
<div class="line">ArrayNumberOfStations=128</div>
<div class="line"> </div>
<div class="line">ArrayFile=</div>
<div class="line"> </div>
<div class="line">SourceCatalogueFile=/astro/mwavcs/vcs/1318345216/cal/1318345216/srclist_pumav3_EoR0aegean_EoR1pietro+ForA_1318345216_patch1000.txt</div>
<div class="line">NumberOfCalibrators=1</div>
<div class="line">NumberOfSourcesToPeel=0</div>
<div class="line">calBaselineMin=20.0</div>
<div class="line">calShortBaselineTaper=40.0</div>
<div class="line">FieldOfViewDegrees=1</div>
</div><!-- fragment --><p>For an as yet unknown reason, this RTS job timed out, even after allowing 4 hours of wall time.</p>
<h2><a class="anchor" id="autotoc_md64"></a>
Incoherent Beam</h2>
<p>(Currently not tested since v2.18. Results not guaranteed. As of this writing, 21 Dec 2021, only supported for legacy data.)</p>
<div class="fragment"><div class="line">$ cd /astro/mwavcs/vcs/1320499816/vcsbeam/incoh</div>
<div class="line">$ sbatch vcsbeam_incoh.sbatch</div>
</div><!-- fragment --><p><b>vcsbeam_incoh.sbatch</b>: </p><div class="fragment"><div class="line">#!/bin/bash -l</div>
<div class="line"> </div>
<div class="line">#SBATCH --nodes=24</div>
<div class="line">#SBATCH --ntasks-per-node=1</div>
<div class="line">#SBATCH --cpus-per-task=1</div>
<div class="line">#SBATCH --mem=370gb</div>
<div class="line">#SBATCH --partition=gpuq</div>
<div class="line">#SBATCH --gres=gpu:1</div>
<div class="line">#SBATCH --time=00:30:00</div>
<div class="line">#SBATCH --account=mwavcs</div>
<div class="line">#SBATCH --nice=0</div>
<div class="line">#SBATCH --export=NONE</div>
<div class="line"> </div>
<div class="line">module use /pawsey/mwa/software/python3/modulefiles</div>
<div class="line">module load vcsbeam</div>
<div class="line"> </div>
<div class="line">srun -N 24 -n 24 make_mwa_incoh_beam \</div>
<div class="line">    -m /astro/mwavcs/vcs/1320499816/vcsbeam/1320499816_legacy.metafits \</div>
<div class="line">    -b 1320499816 \</div>
<div class="line">    -T 600 \</div>
<div class="line">    -f 109 \</div>
<div class="line">    -d /astro/mwavcs/vcs/1320499816/combined \</div>
<div class="line">    -o incoh</div>
</div><!-- fragment --><p>After beamforming finishes, fold on B0031-07:</p>
<div class="fragment"><div class="line">$ module load singularity</div>
<div class="line">$ /pawsey/mwa/singularity/presto/presto.sif prepfold -psr J0034-0721 -nosearch -nodmsearch -start 0.01 incoh*.fits</div>
</div><!-- fragment --><div class="image">
<img src="example_1320499816_presto_incoh.png" alt="" width="500px"/>
</div>
  </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
