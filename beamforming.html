<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VCSBeam: Beamforming</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VCSBeam
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Beamforming </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md12">Applying the calibration solutions</a></li>
<li class="level1"><a href="#autotoc_md13">Phasing up</a></li>
<li class="level1"><a href="#autotoc_md14">Summing the voltages</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_03_Beamforming"></a></p>
<p>Beamforming consists of three steps:</p><ol type="1">
<li>Applying the calibration Jones matrices to the voltages measured at each tile,</li>
<li>Shifting the signals from each tile in time to account for the signal delay from the look-direction to each tile, due to the geometric layout of the MWA tiles ("phasing up"),</li>
<li>Summing the voltages from all the tiles together. These steps are described more fully in <a href="https://www.cambridge.org/core/journals/publications-of-the-astronomical-society-of-australia/article/abs/mwa-tiedarray-processing-i-calibration-and-beamformation/E9A7A9981AE9A935C9E08500CA6A1C1E">Ord et al., 2019</a>, but are discussed further in the following subsections.</li>
</ol>
<h1><a class="anchor" id="autotoc_md12"></a>
Applying the calibration solutions</h1>
<p>In VCSBeam, the following bases are used: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{aligned} {\bf v} &amp;= {\bf J}{\bf e} \\ {\bf v} &amp;= {\bf D} {\bf B}_\text{hb} {\bf P}_\text{pa} {\bf e} \\ \begin{bmatrix} v_q \\ v_p \end{bmatrix} &amp;= \begin{bmatrix} D_{qq} &amp; D_{qp} \\ D_{pq} &amp; D_{pp} \end{bmatrix} \begin{bmatrix} B_{q\theta} &amp; B_{q\phi} \\ B_{p\theta} &amp; B_{p\phi} \end{bmatrix} \begin{bmatrix} P_{\theta x} &amp; B_{\theta y} \\ B_{\phi x} &amp; B_{\phi y} \end{bmatrix} \begin{bmatrix} e_x \\ e_y \end{bmatrix} \end{aligned} \]" src="form_50.png" width="271" height="68"/>
</p>
<p>The <img class="formulaInl" alt="${\bf D}$" src="form_26.png" width="11" height="10"/> matrix, if obtained using Hyperdrive, is already in the correct basis, and can be used as is. However, if the RTS is used, the matrix must be permuted first. In memory, matrices are represented as an array of <code>cuDoubleComplex</code>s (from the CUDA library), in the following order: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{bmatrix} 1 &amp; 2 \\ 3 &amp; 4 \end{bmatrix}. \]" src="form_51.png" width="41" height="31"/>
</p>
<p> Therefore, the required permutation to get the <img class="formulaInl" alt="${\bf D}$" src="form_26.png" width="11" height="10"/> matrix in the correct order is a "reversal" of the matrix elements in memory: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{aligned} \begin{bmatrix} 1 &amp; 2 \\ 3 &amp; 4 \end{bmatrix} &amp;\rightarrow \begin{bmatrix} 4 &amp; 3 \\ 2 &amp; 1 \end{bmatrix} \\ \begin{bmatrix} D_{pp} &amp; D_{pq} \\ D_{qp} &amp; D_{qq} \end{bmatrix} &amp;\rightarrow \begin{bmatrix} D_{qq} &amp; D_{qp} \\ D_{pq} &amp; D_{pp} \end{bmatrix} \end{aligned} \]" src="form_52.png" width="150" height="66"/>
</p>
<p>Currently, only Hyperbeam is used for the FEE beam model, and so the <img class="formulaInl" alt="${\bf B}_\text{hp}$" src="form_53.png" width="23" height="14"/> is already given in the correct basis, <img class="formulaInl" alt="$(\theta,\phi)\rightarrow(q,p)$" src="form_54.png" width="75" height="14"/>.</p>
<p>Finally, the parallactic angle correction matrix is calculated by VCSBeam in the <img class="formulaInl" alt="$(x,y)\rightarrow(\theta,\phi)$" src="form_18.png" width="76" height="14"/> basis, as desired.</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Phasing up</h1>
<p>If the channelisation is fine enough, and if the tile separations (baselines) are not too long, then a time shift can be accurately effected by applying a phase ramp across frequency.</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Summing the voltages</h1>
<p>If we use subscripts <img class="formulaInl" alt="$a$" src="form_55.png" width="6" height="6"/> and <img class="formulaInl" alt="$f$" src="form_56.png" width="8" height="13"/> to represent tiles (i.e. "_a_ntennas") and frequencies respectively, then the complete beamforming operation is </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf e}_f = \sum_a e^{i\varphi_{a,f}} {\bf J}_{a,f}^{-1} {\bf v}_{a,f}, \]" src="form_57.png" width="128" height="28"/>
</p>
<p> where <img class="formulaInl" alt="$\varphi_f$" src="form_58.png" width="14" height="10"/> is the frequency-dependent phase difference between the arrival of a signal at a given tile relative to an arbitrary reference point, or "array phase centre". </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
