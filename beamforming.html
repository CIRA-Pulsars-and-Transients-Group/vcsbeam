<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VCSBeam: Beamforming</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">VCSBeam
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Beamforming </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md11">Generating and applying the calibration solutions</a></li>
<li class="level1"><a href="#autotoc_md12">Phasing up</a></li>
<li class="level1"><a href="#autotoc_md13">Averaging the voltages</a></li>
<li class="level1"><a href="#autotoc_md14">Detection (forming Stokes parameters)</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_Beamforming"></a></p>
<p>Beamforming is expressed mathematically by the expression </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf e}_f = \frac{1}{N_a} \sum_a e^{i\varphi_{a,f}} {\bf J}_{a,f}^{-1} {\bf v}_{a,f}, \]" src="form_66.svg"/>
</p>
<p> where</p>
<ul>
<li><img class="formulaInl" alt="$a$" src="form_67.svg"/> represents tiles (i.e. "antennas")</li>
<li><img class="formulaInl" alt="$f$" src="form_68.svg"/> represents frequency channels</li>
<li><img class="formulaInl" alt="$\varphi$" src="form_69.svg"/> is the delay phase,</li>
<li><img class="formulaInl" alt="${\bf v}$" src="form_47.svg"/> is the Jones vector describing the instrumental voltages</li>
<li><img class="formulaInl" alt="${\bf J}$" src="form_41.svg"/> is the Jones matrix describing the instrumental response to an incident electric field</li>
<li><img class="formulaInl" alt="${\bf e}$" src="form_46.svg"/> is the Jones vector describing the (recovered) incident electric field</li>
<li><img class="formulaInl" alt="$N_a$" src="form_27.svg"/> is the number of antennas</li>
</ul>
<p>(The time dependence of these quantities is not shown here.)</p>
<p>Conceptually, we describe beamforming as consisting of the following distinct steps:</p>
<ol type="1">
<li>Generating and applying the calibration Jones matrices to the voltages measured at each tile, (i.e. multiplying <img class="formulaInl" alt="${\bf J}_{a,f}^{-1}$" src="form_70.svg"/> to <img class="formulaInl" alt="${\bf v}_{a,f}$" src="form_71.svg"/>),</li>
<li>Shifting the signals from each tile in time to account for the signal delay from the look-direction to each tile, due to the geometric layout of the MWA tiles ("phasing up"), (i.e. multiplying <img class="formulaInl" alt="$e^{i\varphi_{a,f}})$" src="form_72.svg"/>, and</li>
<li>Averaging over the tiles.</li>
</ol>
<p>For some operating modes, VCSBeam also performs <em>detection</em>, which means forming Stokes parameters, also described below.</p>
<p>These steps are described more fully in <a href="https://www.cambridge.org/core/journals/publications-of-the-astronomical-society-of-australia/article/abs/mwa-tiedarray-processing-i-calibration-and-beamformation/E9A7A9981AE9A935C9E08500CA6A1C1E">Ord et al., 2019</a>, but are discussed further in the following subsections.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Generating and applying the calibration solutions</h1>
<p>The Jones matrix consists of a <em>direction independent</em> component, <img class="formulaInl" alt="${\bf D}_a$" src="form_73.svg"/>, and a <em>direction dependent</em> component, <img class="formulaInl" alt="${\bf B}_{a,f}$" src="form_74.svg"/>, such that </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf J}_{a,f} = {\bf D}_a {\bf B}_{a,f} \]" src="form_75.svg"/>
</p>
<p> <img class="formulaInl" alt="${\bf D}_a$" src="form_73.svg"/>, which only depends on the antenna, is the <em>instrumental calibration solution</em>. It is obtained using separate, dedicated calibration software, and VCSBeam currently supports solutions in two formats:</p>
<ol type="1">
<li>The <a class="el" href="fileformats.html#rtsfileformat">RTS format</a>, and</li>
<li>The <a class="el" href="fileformats.html#offringafileformat">Offringa file format</a>.</li>
</ol>
<p><img class="formulaInl" alt="${\bf B}_{a,f}$" src="form_74.svg"/>, which formally depends on both antenna <em>and</em> frequency, is the <em>beam model</em>. If all antennas were identical, the beam model would only depend on frequency, and we could write simply <img class="formulaInl" alt="${\bf B}_f$" src="form_76.svg"/>. In reality, antennas can differ because individual dipole elements can fail at different times. These failures, when detected, are recorded in an observation's metadata, and are used by VCSBeam to obtain beam models for every configuration of live/dead dipoles that are present in a given observation.</p>
<p>The beam models themselves are calculated using <a href="https://github.com/MWATelescope/mwa_hyperdrive">Hyperbeam</a>, which implements the FEE beam model described in <a href="https://www.cambridge.org/core/journals/publications-of-the-astronomical-society-of-australia/article/calibration-and-stokes-imaging-with-full-embedded-element-primary-beam-model-for-the-murchison-widefield-array/FBA84B9EB94000BD6258A8F75840C476#">Sokolowski et al. (2017)</a>.</p>
<p>The product obtained by multiplying <img class="formulaInl" alt="${\bf J}^{-1}$" src="form_77.svg"/> to the voltage data is </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \tilde{\bf e}_{a,f} = {\bf J}^{-1}_{a,f} {\bf v}_{a,f}. \]" src="form_78.svg"/>
</p>
<h1><a class="anchor" id="autotoc_md12"></a>
Phasing up</h1>
<p>Phasing up refers to the process of accounting for the fact that each antenna will "see" an astrophysical signal arriving at a different time due to</p>
<ol type="1">
<li>Its location relative to the source, and</li>
<li>The different lengths of the cables that connect the antennas to the rest of the system.</li>
</ol>
<p>Accounting for these time differences can be achieved either by a simple shift in the time domain, or, equivalently, the application of a phase ramp in the frequency domain, via the shift theorem. The latter is what's implemented in VCSBeam, as indicated by the <img class="formulaInl" alt="$e^{i\varphi}$" src="form_79.svg"/> term in the expression above. Thus, the result of phasing up is </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf e}_{a,f} = e^{i\varphi_f} \tilde{\bf e}_{a,f}. \]" src="form_80.svg"/>
</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Averaging the voltages</h1>
<p>The final step is simply summing the voltages over all antennas. As long as the correct delays have been applied, summing the voltages will coherently combine any astrophysical signal arriving from the specified look-direction. The result is </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf e}_f = \frac{1}{N_a}\sum_a \tilde{\bf e}_{a,f}. \]" src="form_81.svg"/>
</p>
<h1><a class="anchor" id="autotoc_md14"></a>
Detection (forming Stokes parameters)</h1>
<p>VCSBeam converts the summed voltages into Stokes parameters if the PSRFITS output format is requested. This is achieved by forming the <em>coherency matrix</em>: </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ {\bf e}{\bf e}^\dagger = \begin{bmatrix} e_x e_x^\ast &amp; e_x e_y^\ast \\ e_y e_x^\ast &amp; e_y e_y^\ast \end{bmatrix} = \frac12 \begin{bmatrix} I + Q &amp; U + Vi \\ U - Vi &amp; I - Q \end{bmatrix} \]" src="form_82.svg"/>
</p>
<p> where the frequency dependence of all terms is implicit.</p>
<p>However, as described in <a href="https://www.cambridge.org/core/journals/publications-of-the-astronomical-society-of-australia/article/abs/mwa-tiedarray-processing-i-calibration-and-beamformation/E9A7A9981AE9A935C9E08500CA6A1C1E">Ord et al. (2019)</a>, VCSBeam also subtracts the autocorrelations, which for signals which are noise-dominated on a single-tile basis, improves the signal-to-noise ratio. Thus, the actual detection operation that is implemented in VCSBeam is </p><p class="formulaDsp">
<img class="formulaDsp" alt="\[ \frac12 \begin{bmatrix} I + Q &amp; U + Vi \\ U - Vi &amp; I - Q \end{bmatrix} = {\bf e}{\bf e}^\dagger - \sum_a {\bf e}_a {\bf e}_a^\dagger. \]" src="form_83.svg"/>
</p>
 </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
